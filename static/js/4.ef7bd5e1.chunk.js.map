{"version":3,"sources":["assets/marketing/optic-contract-testing-diagram.svg","services/testing/index.ts","services/testing/ExampleTestingService.ts","contexts/TestingDashboardContext.js","components/testing/report-link.js","components/testing/EndpointReport.js","components/testing/ReportSummary.js","components/testing/SetupLink.js","components/testing/ReportsNav.js","components/marketing/TestingPromo.js","components/dashboards/TestingDashboard.js","services/testing/TestingService.ts","config.js","components/loaders/TestingDashboardLoader.js"],"names":["module","exports","TESTING_SERVICE_ERROR_TYPE","Symbol","NotFoundError","statusCode","type","this","maybeErr","Error","Ok","value","isOk","Err","error","isErr","ok","err","createExampleTestingService","getSpecEvents","getSamples","notFoundErr","a","captureId","samples","samplesByCaptureId","spec","specs","exampleId","fetch","headers","accept","then","response","json","example","orgId","captures","ExampleTestingService","Promise","r","setTimeout","map","createdAt","updatedAt","completedAt","tags","name","capture","find","events","queriesFromEvents","rfcState","queries","shapesResolvers","samplesSeq","JsonHelper","jsArrayToSeq","x","fromInteraction","converter","opticEngine","com","useoptic","CoverageReportConverter","StableHasher","report","diff","helpers","CoverageHelpers","getCoverage","asJs","CoverageReportJsonSerializer","toJs","console","log","fromJs","CoverageReportJsonDeserializer","e","serializedReport","pathId","httpMethod","sample","diffManager","DiffManagerFacade","newFromInteractions","updatedRfcState","endpointDiffManager","managerForPathAndMethod","regions","diffRegions","newRegions","seqToJsArray","bodyDiffs","undocumentedUrlsSeq","unmatchedUrls","method","path","count","rfcServiceFacade","RfcServiceJSFacade","contexts","rfc","eventStore","makeEventStore","eventsForScala","EventSerialization","append","rfcService","makeRfcService","Queries","currentState","TestingDashboardContext","React","createContext","Provider","useTestingService","performRequest","deps","useContext","service","versionRef","useRef","useReducer","serviceStateReducer","current","loading","result","notFound","state","dispatch","isUnmounted","useEffect","effectVersion","effectDispatch","action","version","latestVersion","payload","unwrapErr","useReportPath","baseUrl","ReportLink","props","otherProps","to","EndpointReportContainer","endpoint","loadEndpointDiffs","diffsSummary","useMemo","responseNewRegions","filter","getInResponse","responseBodyDiffs","requestNewRegions","getInRequest","requestBodyDiffs","requests","regionDiffs","createRegionDiff","createShapeDiff","unmatchedContentTypes","getContentType","responses","unmatchedStatusCodes","getStatusCode","totalCount","length","inRequest","inResponse","contentType","interaction","getIndex","interactions","body","request","id","toString","assertion","description","getOrUndefined","changeType","changeTypeAsString","summary","createEndpointsDiffSummary","EndpointReport","endpointCounts","counts","endpointPurpose","descriptor","loadingDiffsSummary","classes","useStyles","containerRef","isCurrent","scrollIntoView","scrollMode","block","useScrollToCurrent","ref","className","root","EndpointDiffsSummary","diffsContainer","ClassNames","diffs","requestDiffs","diffsLocationHeader","diffsList","key","diffsListItem","NewRegionDiffDescription","BodyDiffDescription","responseDiffs","diffContainer","diffDescription","diffMeta","diffFieldTrail","diffFieldTrailRoot","diffFieldTrailComponents","pathComponent","i","components","diffFieldTrailComponent","diffFieldTrailSeparator","diffFieldTrailAssertion","diffFielTrailWarningIcon","makeStyles","theme","padding","spacing","typography","h6","margin","marginBottom","overline","color","Color","palette","primary","main","desaturate","lighten","hex","borderBottom","listStyleType","fontSize","pxToRem","subtitle2","grey","fontWeight","fontWeightLight","marginLeft","borderLeft","display","alignItems","alignContent","flexGrow","flexShrink","light","background","flexWrap","dark","darken","width","height","marginRight","removed","ReportSummary","currentEndpointId","classesHttpMethods","useHttpMethodStyles","reportPath","apiName","specEndpoints","endpoints","totalInteractions","getCoverageCount","CoverageConcerns","TotalInteractions","totalUnmatchedPaths","TotalUnmatchedPath","endpointDescriptor","createEndpointDescriptor","endpointId","getEndpointId","interactionsCounts","TotalForPathAndMethod","compliantCount","TotalForPathAndMethodWithoutDiffs","incompliantInteractions","diffsCount","compliant","incompliant","totalDiffs","reduce","sum","num","totalCompliantInteractions","buildIdTag","envTag","asDate","isCapturing","buildId","environment","_sortBy","fullPath","concern","hash","coverageCounts","isoDate","dateParseISO","createSummary","history","useHistory","onClickList","useCallback","stopPropagation","onClickContainer","replace","undocumentedEndpoints","undocumented","now","Date","usePageTitle","onClick","reportMeta","captureTime","liveIndicator","recordIcon","liveLabel","historyIcon","dateFormatRelative","dateFormatDistance","stats","SummaryStats","totalUndocumentedEndpoints","buildName","endpointsHeader","endpointsList","endpointHeader","classNames","endpointMethod","endpointPath","endpointStats","process","endpointChip","endpointIncompliantChip","endpointCompliantChip","endpointsListItem","Card","endpointCard","endpointLink","diffsStat","Stat","label","pluralize","undocumentedStat","Typography","variant","style","component","LoadingReportSummary","Skeleton","displayName","maxWidth","breakpoints","values","lg","flexDirection","justifyContent","marginTop","fill","secondary","caption","summaryStat","isUndocumented","backgroundColor","boxShadow","willChange","transition","shadows","textDecoration","gridTemplateColumns","gridColumnGap","borderRadius","shape","fontWeightRegular","opacity","fontStyle","lineHeight","endpointDiffsChip","warning","success","base","styles","httpMethods","coverage","href","children","target","ReportsNavigation","currentCaptureId","onCapturesFetched","listCaptures","capturesLists","rawCaptures","rawCap","isActive","groupedByActive","groupBy","active","completed","createCapturesLists","mockCaptureLists","Array","from","_","n","navRoot","activeCaptures","capturesList","captureListItem","MockActiveCapture","activeCapture","ActiveCapture","MockCompletedCapture","completeCapture","CompletedCapture","domRef","CaptureNavLink","card","isComplete","navLink","activeClassName","loadingCapture","loadingCaptureLine","linkRef","position","overflowY","borderRight","transform","updated","join","subtitle1","envTagName","border","borderTopLeftRadius","borderBottomLeftRadius","paddingLeft","paddingRight","envTagVal","borderTopRightRadius","borderBottomRightRadius","TestingPromo","promo","CardMedia","promoDiagram","image","LiveTestingDiagram","up","md","h2","h4","backgroundSize","backgroundPosition","FIRST_CAPTURE_INIT","TestingDashboardPage","match","hasService","url","routerPaths","useRouterPaths","captureMatch","matchPath","location","pathname","testingCapture","params","dashboardContext","useState","firstCapture","setFirstCapture","hasCaptures","Page","title","Navbar","mini","Body","padded","isEmpty","navigationContainer","reportContainer","strict","testingEndpointDetails","TestingDashboard","TestingDashboardSetup","Loading","TestingDashboardSetupPage","setup","setupInstructions","SetupLink","SupportLinks","loadReport","loadingReport","reportError","reportNotFound","loadSpecEvents","specEvents","hookRest","stuffFromQueries","createSpec","useSpec","loadingSpec","specError","loadCapture","captureError","captureNotFound","loadUndocumentedEndpoints","loadingUndocumentedEndpoints","undocumentedEndpointsError","undocumentedEndpointsNotFound","ReportNotFound","down","sm","body1","TestingService","fetchAuthToken","authToken","refreshing","refreshAuth","options","Headers","UrlJoin","set","status","refresh","callApi","deserialized","TestingServiceLoader","debugData","useMockData","setService","specService","useSpecService","enabledFeatures","useEnabledFeatures","available","TESTING_DASHBOARD","serviceFactory","createExampleTestingServiceFactory","data","getTestingCredentials","bind","Config","s","task","reportsExample","refs","rel"],"mappings":"6EAAAA,EAAOC,QAAU,IAA0B,4D,kRC2ErCC,EAA6BC,OAAO,yBAc7BC,EAAb,4MACEC,WAAa,IADf,YAbA,4MACEA,gBADF,IAEEC,KAAeJ,EAFjB,yDASI,OAA2B,MAApBK,KAAKF,cAThB,kCAIoBG,GAChB,OAAOA,GAAYA,EAASF,OAASJ,MALzC,eAAyCO,SAuB5BC,EAAb,WAEE,WAAqBC,GAAW,yBAAXA,QAFvB,mDAKI,OAAO,IALX,8BASI,OAAQJ,KAAKK,SATjB,+BAaI,OAAOL,KAAKI,QAbhB,kCAiBI,MAAM,IAAIF,MAAM,iCAjBpB,KAqBaI,EAAb,WAEE,WAAqBC,GAAW,yBAAXA,QAFvB,mDAKI,OAAQP,KAAKQ,UALjB,8BASI,OAAO,IATX,+BAaI,MAAMR,KAAKO,QAbf,kCAiBI,OAAOP,KAAKO,UAjBhB,KAyBO,SAASE,EACdL,GAEA,OAAO,IAAID,EAAGC,GAGT,SAASM,EAAsCA,GACpD,OAAO,IAAIJ,EAAII,G,aCtIV,SAAeC,IAAtB,+B,4CAAO,6BAcIC,EAWAC,EAWAC,EApCJ,uBAAAC,EAAA,6DAoCID,EApCJ,WAqCH,OAAO,IAAIjB,GAZJgB,EAzBJ,SAyBeG,GAClB,IAAMC,EAAUC,EAAmBF,GACnC,MAAuB,kBAAZC,EAGFJ,EAAWI,GAEXA,GAlBFL,EAdJ,SAckBI,GACrB,IAAMG,EAAOC,EAAMJ,GACnB,MAAoB,kBAATG,EAGFP,EAAcO,GAEdA,GArBqCE,EAA3C,+BAAuD,cAAvD,SACiBC,MAAM,oBAAD,OAAqBD,EAArB,SAAuC,CAChEE,QAAS,CACPC,OAAQ,sBAETC,MAAK,SAACC,GACP,GAAIA,EAASjB,GACX,OAAOiB,EAASC,OAElB,MAAM,IAAIzB,SATP,cACC0B,EADD,OAYGC,EAAwDD,EAAxDC,MAAOT,EAAiDQ,EAAjDR,MAAgBF,EAAiCU,EAA1CX,QAA6Ba,EAAaF,EAAbE,SA4B7CC,EAxCD,WA2CH,WAAYF,GAAQ,yBAFpBA,WAEmB,EACjB7B,KAAK6B,MAAQA,EA5CZ,iFAAAd,EAAA,iBAgDDC,GAhDC,eAAAD,EAAA,sEAkDK,IAAIiB,SAAQ,SAACC,GAAD,OAAOC,WAAWD,EAAG,QAlDtC,UAoDKd,EAAOP,EAAcI,GApD1B,yCAsDiBN,EAAII,MAtDrB,gCAwDML,EAAGU,IAxDT,2JAAAJ,EAAA,4BAAAA,EAAA,sEA4DK,IAAIiB,SAAQ,SAACC,GAAD,OAAOC,WAAWD,EAAG,QA5DtC,gCA8DMxB,EACLqB,EAASK,KAEP,YACE,MAAO,CACLnB,UAFwD,EAAzDA,UAGCoB,UAHwD,EAA9CA,UAIVC,UAJwD,EAAnCA,UAKrBC,YALwD,EAAxBA,YAMhCC,KANwD,EAAXA,KAMlCJ,KAAI,kBAAsB,CACnCK,KADa,EAAGA,KAEhBpC,MAFa,EAASA,gBAvE/B,yJAAAW,EAAA,iBAiFeC,GAjFf,eAAAD,EAAA,sEAkFK,IAAIiB,SAAQ,SAACC,GAAD,OAAOC,WAAWD,EAAG,QAlFtC,UAmFKQ,EAAUX,EAASY,MACvB,SAACD,GAAD,OAAazB,IAAcyB,EAAQzB,aApFpC,yCAsFoBN,EAAII,MAtFxB,gCAwFML,EAAGgC,IAxFT,yJAAA1B,EAAA,iBA4FDC,GA5FC,qCAAAD,EAAA,sEA8FK,IAAIiB,SAAQ,SAACC,GAAD,OAAOC,WAAWD,EAAG,QA9FtC,UA+FKU,EAAS/B,EAAcI,GACvBC,EAAUJ,EAAWG,GAEtB2B,GAAW1B,EAlGf,yCAkG+BP,EAAII,MAlGnC,SAoG6B8B,EAAkBD,GAAxCE,EApGP,EAoGOA,SAAUC,EApGjB,EAoGiBA,QACZC,EAAkBD,EAAQC,kBAE1BC,EAAaC,aAAWC,aAC5BjC,EAAQkB,KAAI,SAACgB,GAAD,OAAOF,aAAWG,gBAAgBD,OAE1CE,EAAY,IAAIC,cAAYC,IAAIC,SAASC,wBAC7CC,gBAEIC,EAASL,cAAYC,IAAIC,SAASI,KAAKC,QAC1CC,kBACAC,YAAYhB,EAAiBF,EAAUG,GAC1C,IACQgB,EAAOV,cAAYW,6BAA6BC,KAAKP,GAC3DQ,QAAQC,IAAI,CAAEJ,SACRK,EAASf,cAAYgB,+BAA+BD,OAAOL,GACjEG,QAAQC,IAAI,CAAEC,WACd,MAAOE,IArHR,OAyHKC,EAAmBnB,EAAUa,KAAKP,GAzHvC,kBA0HMlD,EAAG+D,IA1HT,iKAAAzD,EAAA,iBA8HDC,EACAyD,EACAC,GAhIC,+BAAA3D,EAAA,yDAkIK4B,EAAS/B,EAAcI,GACvBC,EAAUJ,EAAWG,GAEtB2B,GAAW1B,EArIf,yCAqI+BP,EAAII,MArInC,gBAuI6B8B,EAAkBD,GAAxCE,EAvIP,EAuIOA,SAAUC,EAvIjB,EAuIiBA,QACZC,EAAkBD,EAAQC,kBAEXE,aAAWC,aAC9BjC,EAAQkB,KAAI,SAACwC,GAAD,OAAY1B,aAAWG,gBAAgBuB,QAG/CC,EAAcC,oBAAkBC,oBACpC7D,GACA,gBAEU8D,gBAAgBlC,EAAUE,GAChCiC,EAAsBJ,EAAYK,wBACtCR,EACAC,EACAzB,aAAWC,aAAa,KAGpBgC,EAAUF,EAAoBG,YAzJnC,kBA8JM1E,EAAG,CACR2E,WAAYnC,aAAWoC,aAAaH,EAAQE,YAC5CE,UAAWrC,aAAWoC,aAAaH,EAAQI,cAhK5C,6KAAAvE,EAAA,iBAqKDC,GArKC,6BAAAD,EAAA,sEAuKK,IAAIiB,SAAQ,SAACC,GAAD,OAAOC,WAAWD,EAAG,QAvKtC,UAwKKU,EAAS/B,EAAcI,GACvBC,EAAUJ,EAAWG,GAEtB2B,GAAW1B,EA3Kf,yCA2K+BP,EAAII,MA3KnC,gBA6K6B8B,EAAkBD,GAAxCE,EA7KP,EA6KOA,SAAUC,EA7KjB,EA6KiBA,QACZC,EAAkBD,EAAQC,mBAE1B6B,EAAcC,oBAAkBC,oBACpC7D,GACA,gBAEU8D,gBAAgBlC,EAAUE,GAEhCwC,EAAsBX,EAAYY,eAAc,GAtLrD,kBAwLM/E,EACLwC,aAAWoC,aAAaE,GAAqBpD,KAC3C,YACE,MAAO,CACLsD,OAFiC,EAAlCA,OAGCC,KAHiC,EAA1BA,KAIPjB,OAJiC,EAApBA,OAKbkB,MALiC,EAAZA,YA1L5B,4HAuME,IAAI5D,EAAsBF,IAvM5B,6C,sBA2MA,SAASe,EAAkBD,GAAS,IAGnCiD,GAAmBC,EAFJvC,cAAYC,IAAIC,SAA7BsC,SACgCC,IAAhCF,sBAEFG,EAAaJ,EAAiBK,iBAG9BC,EAAiB5C,cAAY6C,mBAAmB9B,OAAO1B,GAC7DqD,EAAWI,OAHG,YAGWF,GACzB,IAAMG,EAAaT,EAAiBU,eAAeN,GAInD,MAAO,CAAElD,QAHOyD,kBAAQP,EAAYK,EALtB,aAQIxD,SAFDwD,EAAWG,aANd,cCzNhB,IAAMC,EAA0BC,IAAMC,cAAc,MAGrCC,EAAaH,EAAbG,SAQR,SAASC,EACdC,GAEC,IADDC,EACA,uDADO,GACP,EACoBC,qBAAWP,GAAvBQ,EADR,EACQA,QAEFC,EAAaC,iBAAO,GAH1B,EAI0BC,qBACxBC,GACoBH,EAAWI,QA+D1B,CACLC,SAAS,EACTC,OAAQ,KACRjH,MAAO,KACPkH,UAAU,KAzEZ,mBAIOC,EAJP,KAIcC,EAJd,KASMC,EAAcT,kBAAO,GAuC3B,OArCAU,qBAAU,WACR,IAAMC,EAAgBZ,EAAWI,QAEjC,SAASS,EAAeC,GACtB,OAAOL,EAAS,2BACXK,GADU,IAEbC,QAASH,EACTI,cAAehB,EAAWI,WAmB9B,OAfAS,EAAe,CAAEhI,KAAM,YACvB+G,EAAeG,GAASxF,MAAK,SAAC+F,GAC5B,IAAII,EAAYN,QAChB,GAAIE,EAAOnH,OACT0H,EAAe,CAAEhI,KAAM,kBAAmBoI,QAASX,EAAOpH,YACrD,CACL,IAAIM,EAAM8G,EAAOY,YACb1H,EAAI+G,WACNM,EAAe,CAAEhI,KAAM,sBAEvBgI,EAAe,CAAEhI,KAAM,gBAAiBoI,QAASzH,QAKhD,WACLwG,EAAWI,aAEZP,GAEHc,qBAAU,WACR,OAAO,WACLD,EAAYN,SAAU,KAEvB,IAEII,EAGF,SAASW,EAAcrH,GAAY,IAChCsH,EAAYtB,qBAAWP,GAAvB6B,QAER,MAAM,GAAN,OAAUA,EAAV,qBAA8BtH,GAuBhC,SAASqG,EAAoBK,EAAOM,GAClC,GAAIA,EAAOC,UAAYD,EAAOE,cAC5B,OAAOR,EAGT,OAAQM,EAAOjI,MACb,IAAK,UACH,OAAO,2BAfJ,CACLwH,SAAS,EACTC,OAAQ,KACRjH,MAAO,KACPkH,UAAU,IAWR,IAEEF,SAAS,IAGb,IAAK,kBACH,OAAKG,EAAMH,QAEJ,2BACFG,GADL,IAEEF,OAAQQ,EAAOG,QACfZ,SAAS,IALgBG,EAQ7B,IAAK,oBACH,OAAKA,EAAMH,QAEJ,2BACFG,GADL,IAEEH,SAAS,EACTC,OAAQ,KACRC,UAAU,IANeC,EAS7B,IAAK,gBACH,OAAKA,EAAMH,QAEJ,2BACFG,GADL,IAEEH,SAAS,EACTC,OAAQ,KACRjH,MAAOyH,EAAOG,UANWT,EAS7B,QACE,MAAM,IAAIxH,MAAJ,+BACoB8H,EAAOjI,KAD3B,iC,+FCvIG,SAASwI,GAAWC,GAAQ,IACjCxH,EAA6BwH,EAA7BxH,UAAcyH,EADkB,YACHD,EADG,eAElC9C,EAAO2C,EAAcrH,GAE3B,OAAO,kBAAC,KAAD,iBAAayH,EAAb,CAAyBC,GAAIhD,K,wDCDvB,SAASiD,GAAwBH,GAAQ,IAC9CxH,EAAwBwH,EAAxBxH,UAAW4H,EAAaJ,EAAbI,SADkC,EAEL/B,GAAkB,SAACI,GAAD,OAChEA,EAAQ4B,kBAAkB7H,EAAW4H,EAASnE,OAAQmE,EAASnD,WADzDlF,EAF6C,EAE7CA,MAAOgH,EAFsC,EAEtCA,QAAiBpC,EAFqB,EAE7BqC,OAIlBsB,EAAeC,mBAAQ,WAC3B,OAAK5D,EA8WT,SAAoCA,GAAc,IACxCG,EAA0BH,EAA1BG,UAAWF,EAAeD,EAAfC,WAEb4D,EAAqB5D,EAAW6D,OAAOC,GACvCC,EAAoB7D,EAAU2D,OAAOC,GACrCE,EAAoBhE,EAAW6D,OAAOI,GACtCC,EAAmBhE,EAAU2D,OAAOI,GAEpCE,EAAW,CACfC,YAAaJ,EAAkBjH,IAAIsH,GACnCnE,UAAWgE,EAAiBnH,IAAIuH,GAChCC,sBAAuBP,EACpBH,OAAOW,GACPzH,IAAIyH,IAGHC,EAAY,CAChBL,YAAaR,EAAmB7G,IAAIsH,GACpCnE,UAAW6D,EAAkBhH,IAAIuH,GACjCI,qBAAsBd,EACnBC,OAAOc,GACP5H,IAAI4H,GACPJ,sBAAuBX,EACpBC,OAAOW,GACPzH,IAAIyH,IAGT,MAAO,CACLI,WAAY1E,EAAU2E,OAAS7E,EAAW6E,OAC1CJ,UAAU,2BACLA,GADI,IAEPlE,MAAOkE,EAAUL,YAAYS,OAASJ,EAAUvE,UAAU2E,SAE5DV,SAAS,2BACJA,GADG,IAEN5D,MAAO4D,EAASC,YAAYS,OAASV,EAASjE,UAAU2E,UAI5D,SAASZ,EAAazF,GACpB,OAAOA,EAAKsG,UAEd,SAAShB,EAActF,GACrB,OAAOA,EAAKuG,WAEd,SAASJ,EAAcnG,GACrB,OAAOA,EAAK9D,WAEd,SAAS8J,EAAehG,GACtB,OAAOA,EAAKwG,YAEd,SAASV,EAAgB9F,GACvB,IAAMyG,EAAcC,mBAAS1G,EAAK2G,aAAdD,CAA4B,GAC1CE,EAAO5G,EAAKsG,UACdG,EAAYI,QAAQD,KACpBH,EAAY3I,SAAS8I,KAEzB,MAAO,CACLE,GAAI9G,EAAK+G,WACTC,UAAWhH,EAAKiH,YAAYD,UAC5BR,YAAaU,yBAAeN,EAAKJ,aACjCzE,MAAO,EACPoF,WAAYnH,EAAKiH,YAAYG,mBAC7BtF,KAAMzC,aAAWoC,aAAazB,EAAKiH,YAAYnF,MAC/CuF,QAASrH,EAAKiH,YAAYI,QAC1BnL,WAAY8D,EAAKuG,WAAaE,EAAY3I,SAAS5B,WAAa,MAIpE,SAAS2J,EAAiB7F,GACxB,MAAO,CACL8G,GAAI9G,EAAK+G,WACThF,MAAO,EACPyE,YAAaU,yBAAelH,EAAKwG,aACjCtK,WAAYgL,yBAAelH,EAAK9D,YAChCiL,WAAYnH,EAAKiH,YAAYG,mBAC7BC,QAASrH,EAAKiH,YAAYI,SAAWrH,EAAKiH,YAAYD,YAzbjDM,CAA2B/F,GADT,QAI3B,GAAI5E,EAAO,MAAMA,EAEjB,OACE,kBAAC4K,GAAD,CACEC,eAAgBxC,EAASyC,OACzBC,gBAAiB1C,EAAS2C,WAAWD,gBACrCE,oBAAqBjE,EACrBuB,aAAcA,IAKb,SAASqC,GAAe3C,GAAQ,IAC7BM,EAAkDN,EAAlDM,aAAcwC,EAAoC9C,EAApC8C,gBAEhBG,GAFoDjD,EAAnB4C,eAEvBM,MACVC,EAwMR,SAA4BC,GAC1B,IAAMD,EAAexE,mBAerB,OAdAU,qBAAU,WACR,GAAK+D,EAAL,CAEA,IAAKD,EAAarE,QAChB,MAAMpH,MACJ,+EAGJ2L,aAAeF,EAAarE,QAAS,CACnCwE,WAAY,YACZC,MAAO,cAER,CAACH,IAEGD,EAxNcK,EAAmB,GAExC,OACE,yBAAKC,IAAKN,EAAcO,UAAWT,EAAQU,MACzC,wBAAID,UAAWT,EAAQH,iBAAkBA,GAExCxC,GAAgB,kBAACsD,GAAD,CAAsBtD,aAAcA,KAK3D,SAASsD,GAAT,GAAiD,IAAjBtD,EAAgB,EAAhBA,aACtBe,EAAwBf,EAAxBe,UAAWN,EAAaT,EAAbS,SACbkC,EAAUC,KAEhB,OAAI5C,EAAakB,WAAa,EACrB,0CAGL,yBAAKkC,UAAWT,EAAQY,gBACrB9C,EAAS5D,MAAQ,GAChB,yBAAKuG,UAAWI,IAAWb,EAAQc,MAAOd,EAAQe,eAChD,wBAAIN,UAAWT,EAAQgB,qBAAvB,YAEA,oCACGlD,EAASC,YAAYS,OAAS,GAC7B,wBAAIiC,UAAWT,EAAQiB,WACpBnD,EAASC,YAAYrH,KAAI,SAACyB,GAAD,OACxB,wBAAI+I,IAAK/I,EAAK8G,GAAIwB,UAAWT,EAAQmB,eACnC,kBAACC,GAAD,CACEzC,YAAaxG,EAAKwG,YAClBtK,WAAY8D,EAAK9D,WACjB6F,MAAO/B,EAAK+B,MACZwE,YAAY,SAOrBZ,EAASjE,UAAU2E,OAAS,GAC3B,wBAAIiC,UAAWT,EAAQiB,WACpBnD,EAASjE,UAAUnD,KAAI,SAACyB,GAAD,OACtB,wBAAI+I,IAAK/I,EAAK8G,GAAIwB,UAAWT,EAAQmB,eACnC,kBAACE,GAAD,CACElC,UAAWhH,EAAKgH,UAChBG,WAAYnH,EAAKmH,WACjBpF,MAAO/B,EAAK+B,MACZyE,YAAaxG,EAAKwG,YAClB1E,KAAM9B,EAAK8B,KACXwE,WAAW,WAU1BL,EAAUlE,MAAQ,GACjB,yBAAKuG,UAAWI,IAAWb,EAAQc,MAAOd,EAAQsB,gBAChD,wBAAIb,UAAWT,EAAQgB,qBAAvB,aACA,oCACG5C,EAAUL,YAAYS,OAAS,GAC9B,wBAAIiC,UAAWT,EAAQiB,WACpB7C,EAAUL,YAAYrH,KAAI,SAACyB,GAAD,OACzB,wBAAI+I,IAAK/I,EAAK8G,GAAIwB,UAAWT,EAAQmB,eACnC,kBAACC,GAAD,CACEzC,YAAaxG,EAAKwG,YAClBtK,WAAY8D,EAAK9D,WACjB6F,MAAO/B,EAAK+B,MACZwE,YAAY,SAOrBN,EAAUvE,UAAU2E,OAAS,GAC5B,wBAAIiC,UAAWT,EAAQiB,WACpB7C,EAAUvE,UAAUnD,KAAI,SAACyB,GAAD,OACvB,wBAAI+I,IAAK/I,EAAK8G,GAAIwB,UAAWT,EAAQmB,eACnC,kBAACE,GAAD,CACElC,UAAWhH,EAAKgH,UAChBG,WAAYnH,EAAKmH,WACjBpF,MAAO/B,EAAK+B,MACZyE,YAAaxG,EAAKwG,YAClB1E,KAAM9B,EAAK8B,KACX5F,WAAY8D,EAAK9D,WACjBqK,YAAY,YAcpC,SAAS0C,GAAT,GAMI,IALFzC,EAKC,EALDA,YACAzE,EAIC,EAJDA,MACA7F,EAGC,EAHDA,WACAoK,EAEC,EAFDA,UACAC,EACC,EADDA,WAEMsB,EAAUC,KAEhB,OACE,yBAAKQ,UAAWT,EAAQuB,eACtB,yBAAKd,UAAWT,EAAQwB,iBACrB/C,GACC,kEAC6B,8BAAOE,GADpC,KAKDD,GACC,oDACe,8BAAOrK,GADtB,mBAEE,8BAAOsK,GAFT,MAMJ,2BAAO8B,UAAWT,EAAQyB,UACvB/C,EACG,kDACA,mBAAoB,IAH1B,YAIW,gCAASxE,EAAQ,EAAR,UAAeA,EAAf,UAA+B,UAMzD,SAASmH,GAAT,GASI,IARFlC,EAQC,EARDA,UAEAR,GAMC,EAPDW,WAOC,EANDX,aACAzE,EAKC,EALDA,MACAuE,EAIC,EAJDA,UACAC,EAGC,EAHDA,WACAzE,EAEC,EAFDA,KACA5F,EACC,EADDA,WAEM2L,EAAUC,KAEhB,OACE,yBAAKQ,UAAWT,EAAQuB,eACtB,yBAAKd,UAAWT,EAAQwB,iBACrB/C,GACC,uEACkC,8BAAOE,GADzC,KAKDD,GACC,yDACoB,8BAAOrK,GAD3B,mBAEE,8BAAOsK,GAFT,OAOJ,2BAAO8B,UAAWT,EAAQyB,UAA1B,8CAC8C,IAC5C,gCAASvH,EAAQ,EAAR,UAAeA,EAAf,UAA+B,SAG1C,yBAAKuG,UAAWT,EAAQ0B,gBACtB,yBAAKjB,UAAWT,EAAQ2B,oBACtB,8BACGtN,EADH,IACgBqK,EAAa,WAAa,UAD1C,UAKF,wBAAI+B,UAAWT,EAAQ4B,0BACpB3H,EAAKvD,KAAI,SAACmL,EAAeC,EAAGC,GAAnB,OACR,wBAAItB,UAAWT,EAAQgC,wBAAyBd,IAAKW,GACnD,kBAAC,KAAD,CAAkBpB,UAAWT,EAAQiC,0BACrC,8BAAOJ,GAENC,IAAMC,EAAWvD,OAAS,GACzB,yBAAKiC,UAAWT,EAAQkC,yBACtB,kBAAC,KAAD,CAAazB,UAAWT,EAAQmC,2BAC/BhD,UA8BnB,IAAMc,GAAYmC,aAAW,SAACC,GAAD,MAAY,CACvC3B,KAAM,CACJ4B,QAASD,EAAME,QAAQ,EAAG,IAG5B1C,gBAAgB,2BACXwC,EAAMG,WAAWC,IADP,IAEbC,OAAQ,IAGV9B,eAAgB,GAEhBE,MAAO,CACL6B,aAAcN,EAAME,QAAQ,IAG9BvB,oBAAoB,2BACfqB,EAAMG,WAAWI,UADH,IAEjBF,OAAQL,EAAME,QAAQ,EAAG,EAAG,GAC5BM,MAAOC,IAAMT,EAAMU,QAAQC,QAAQC,MAChCC,WAAW,KACXC,QAAQ,KACRC,MACHC,aAAa,aAAD,OAAeP,IAAMT,EAAMU,QAAQC,QAAQC,MACpDC,WAAW,KACXC,QAAQ,KACRC,SAGLnC,UAAW,CACTqB,QAAS,EACTgB,cAAe,QAGjBnC,cAAe,CACbwB,aAAcN,EAAME,QAAQ,IAG9Bf,gBAAiB,CACf+B,SAAUlB,EAAMG,WAAWgB,QAAQnB,EAAMG,WAAWe,SAAW,GAE/D,SAAU,CACRV,MAAOR,EAAMU,QAAQC,QAAQC,OAIjCxB,SAAS,2BACJY,EAAMG,WAAWiB,WADd,IAENZ,MAAOR,EAAMU,QAAQW,KAAK,KAC1BC,WAAYtB,EAAMG,WAAWoB,gBAC7BL,SAAUlB,EAAMG,WAAWgB,QAAQ,MAGrC9B,eAAgB,CACdY,QAASD,EAAME,QAAQ,IAAK,EAAG,EAAG,KAClCsB,WAAY,EACZC,WAAW,aAAD,OAAezB,EAAMU,QAAQW,KAAK,KAC5CK,QAAS,OACTC,WAAY,aACZC,aAAc,WACdV,SAAUlB,EAAMG,WAAWgB,QAAQnB,EAAMG,WAAWe,SAAW,IAGjE5B,mBAAoB,CAClBoC,QAAS,OACTG,SAAU,EACVC,WAAY,EAEZH,WAAY,SAEZ,SAAU,CACR1B,QAASD,EAAME,QAAQ,GAAK,GAC5BM,MAAOR,EAAMU,QAAQC,QAAQoB,MAC7BC,WAAYhC,EAAMU,QAAQW,KAAK,OAInC9B,yBAA0B,CACxBmC,QAAS,OACTC,WAAY,SACZ1B,QAAS,EACTgC,SAAU,OAEVhB,cAAe,QAGjBtB,wBAAyB,CACvB+B,QAAS,OACTG,SAAU,EACVC,WAAY,EACZxB,aAAcN,EAAME,QAAQ,GAE5ByB,WAAY,SAEZ,SAAU,CACR1B,QAASD,EAAME,QAAQ,GAAK,GAC5BM,MAAOR,EAAMU,QAAQC,QAAQoB,MAC7BC,WAAYhC,EAAMU,QAAQW,KAAK,MAGjC,oBAAqB,CACnBW,WAAYvB,IAAMT,EAAMU,QAAQjO,MAAMsP,OAAOjB,QAAQ,IAAKC,MAC1DP,MAAOC,IAAMT,EAAMU,QAAQjO,MAAMyP,MAAMC,OAAO,IAAKpB,QAIvDlB,wBAAyB,CACvB6B,QAAS,OACTC,WAAY,SACZ1B,QAASD,EAAME,QAAQ,GAAK,GAE5BM,MAAOC,IAAMT,EAAMU,QAAQjO,MAAMyP,MAAMC,OAAO,IAAKpB,OAGrDjB,yBAA0B,CACxBsC,MAAO,GACPC,OAAQ,GACRC,YAAatC,EAAME,QAAQ,GAC3BM,MAAOC,IAAMT,EAAMU,QAAQ6B,QAAQ3B,MAAMuB,OAAO,IAAKpB,OAGvDnB,wBAAyB,CACvBwC,MAAOpC,EAAMG,WAAWgB,QAAQnB,EAAMG,WAAWe,SAAW,GAC5DV,MAAOR,EAAMU,QAAQW,KAAK,UChWf,SAASmB,GAAc9H,GAAQ,IACpC/F,EAA6C+F,EAA7C/F,QAASkB,EAAoC6E,EAApC7E,OAAQxC,EAA4BqH,EAA5BrH,KAAMoP,EAAsB/H,EAAtB+H,kBACzB9E,EAAUC,KACV8E,EAAqBC,KACnBzP,EAAcyB,EAAdzB,UACF0P,EAAarI,EAAcrH,GAE3BiK,EAAUlC,mBAAQ,kBA8lB1B,SAAuBtG,EAAStB,EAAMwC,GAAS,IACrCgN,EAAsCxP,EAAtCwP,QAAoBC,EAAkBzP,EAA7B0P,UAEXC,EAAoBC,EACxBC,GAAiBC,qBAEbC,EAAsBH,EAC1BC,GAAiBG,sBAGbN,EAAYD,EAAczO,KAAI,SAACyG,EAAU2E,GAC7C,IAAM6D,EAAqBC,YAAyBzI,EAAUzH,GACxDmQ,EAAaC,YAAc3I,GAEzBnE,EAAuB2M,EAAvB3M,OAAQC,EAAe0M,EAAf1M,WAEV8M,EAAqBT,EACzBC,GAAiBS,sBAAsBhN,EAAQC,IAE3CgN,EAAiBX,EACrBC,GAAiBW,kCAAkClN,EAAQC,IAEvDkN,EAA0BJ,EAAqBE,EAC/CG,EAAaD,GAA2BrE,EAAI,IAAM,EAAI,EAAI,GAEhE,MAAO,CACL7C,GAAI4G,EACJ7M,OAAQmE,EAASnE,OACjBgB,OAAQmD,EAASnD,OACjB8F,WAAY6F,EACZ/F,OAAQ,CACNd,aAAciH,EACdjF,MAAOsF,EACPC,UAAWJ,EACXK,YAAaH,OAKbI,EAAanB,EAChB1O,KAAI,SAACyG,GAAD,OAAcA,EAASyC,OAAOkB,SAClC0F,QAAO,SAACC,EAAKC,GAAN,OAAcD,EAAMC,IAAK,GAC7BC,EAA6BtB,EAAoBkB,EAEjDK,EAAa5P,EAAQF,KAAKG,MAAK,kBAAuB,YAAvB,EAAGF,QAClC8P,EAAS7P,EAAQF,KAAKG,MAAK,kBAAuB,oBAAvB,EAAGF,QAEpC,MAAO,CACLmO,UACAvO,UAAWmQ,EAAO9P,EAAQL,WAC1BC,UAAWkQ,EAAO9P,EAAQJ,WAC1BC,YAAaiQ,EAAO9P,EAAQH,aAC5BkQ,aAAc/P,EAAQH,YACtBmQ,QAAUJ,GAAcA,EAAWjS,OAAU,GAC7CsS,YAAcJ,GAAUA,EAAOlS,OAAU,GACzCyQ,UAAW8B,IACT9B,GACA,SAACjI,GAAD,OAAeA,EAASyC,OAAO0G,eAC/B,SAACnJ,GAAD,OAAcoJ,EAAapJ,EAASyC,OAAOkB,SAC3C,SAAC3D,GAAD,OAAcA,EAAS2C,WAAWqH,YAClC,SAAChK,GAAD,OAAcA,EAASnD,UAEzBqL,oBACAI,sBACAc,aACAI,8BAGF,SAASrB,EAAiB8B,GACxB,IAAMlG,EAAMjJ,eAAaoP,KAAKD,GAC9B,OAAOlP,EAAOoP,eAAepG,IAAQ,EAGvC,SAAS4F,EAAOS,GACd,OAAOA,GAAWC,YAAaD,IAxqBHE,CAAczQ,EAAStB,EAAMwC,KAAS,CAClElB,EACAtB,EACAwC,IAIIwP,EAAUC,cACVC,EAAcC,uBAAY,SAAC/O,GAE/BA,EAAEgP,qBAEEC,EAAmBF,uBAAY,SAAC/O,GACpC4O,EAAQM,QAAQ/C,MAGZgD,EAAwB3K,mBAC5B,kBACE4J,IACEnK,EAAMkL,uBACN,SAACC,GAAD,OAAmBA,EAAahO,SAChC,SAACgO,GAAD,OAAkBA,EAAajO,QAC/B,SAACiO,GAAD,OAAkBA,EAAalO,YAEnC,CAAC+C,EAAMkL,wBAIP7C,EAME5F,EANF4F,UAEAC,GAIE7F,EALFuH,YAKEvH,EAJF6F,mBAEAkB,GAEE/G,EAHFmH,2BAGEnH,EAFF+G,YACAd,EACEjG,EADFiG,oBAGI0C,EAAM,IAAIC,KAQhB,OANAC,YACE7I,EAAQwH,SAAWxH,EAAQyH,YAA3B,sBACmBzH,EAAQwH,QAD3B,iBAC2CxH,EAAQyH,YADnD,KAEI,UAIJ,yBAAKxG,UAAWT,EAAQU,KAAM4H,QAASP,GACrC,yBAAKtH,UAAWT,EAAQuI,YACtB,yBAAK9H,UAAWT,EAAQwI,aACrBhJ,EAAQuH,YACP,yBAAKtG,UAAWT,EAAQyI,eACtB,kBAAC,IAAD,CAAuBhI,UAAWT,EAAQ0I,aAC1C,0BAAMjI,UAAWT,EAAQ2I,WAAzB,SAGF,kBAAC,IAAD,CAAclI,UAAWT,EAAQ4I,cAElCpJ,EAAQuH,YACP,6CAAS8B,YAAmBrJ,EAAQ7I,UAAWwR,IAE/C,6CACSU,YAAmBrJ,EAAQ3I,YAAasR,GADjD,SAC6D,IAC1DW,YAAmBtJ,EAAQ3I,YAAa2I,EAAQ7I,cAMzD,yBAAK8J,UAAWT,EAAQ+I,OACtB,kBAACC,GAAD,CACE3D,kBAAmBA,EACnBkB,WAAYA,EACZd,oBAAqBA,EACrBwD,2BAA4BhB,EAAsBzJ,SAEpD,wBAAIiC,UAAWT,EAAQkJ,WAAvB,yCACwC,8BAAO1J,EAAQwH,SAAgB,IADvE,MAEK,8BAAOxH,EAAQyH,eAItB,wBAAIxG,UAAWT,EAAQmJ,iBAAvB,aAEC/D,EAAU5G,OAAS,EAClB,wBAAIiC,UAAWT,EAAQoJ,cAAed,QAASV,GAC5CxC,EAAU1O,KAAI,SAACyG,GACd,IAAMkM,EACJ,yBAAK5I,UAAWT,EAAQqJ,gBACtB,0BACE5I,UAAW6I,IACTtJ,EAAQuJ,eACRxE,EAAmB5H,EAAS2C,WAAW7G,cAGxCkE,EAAS2C,WAAW7G,YAEvB,0BAAMwH,UAAWT,EAAQwJ,cACtBrM,EAAS2C,WAAWqH,UAGvB,yBAAK1G,UAAWT,EAAQyJ,eACrBtM,EAASyC,OAAOkB,MAAQ,IACvB4I,EAaDvM,EAASyC,OAAO0G,YAAc,EAC7B,0BACE7F,UAAW6I,IACTtJ,EAAQ2J,aACR3J,EAAQ4J,0BAGV,gCACGzM,EAASyC,OAAO0G,YADnB,IAEGnJ,EAASyC,OAAOd,cAElB,gBAGH,0BACE2B,UAAW6I,IACTtJ,EAAQ2J,aACR3J,EAAQ6J,wBAGV,gCACG1M,EAASyC,OAAOyG,UADnB,IAEGlJ,EAASyC,OAAOd,cAElB,gBAMX,OACE,wBACEoC,IAAK/D,EAAS8B,GACdwB,UAAW6I,IAAWtJ,EAAQ8J,kBAAT,eAClB9J,EAAQG,UACP2E,GAAqB3H,EAAS8B,KAAO6F,KAGzC,kBAACiF,EAAA,EAAD,CAAMtJ,UAAWT,EAAQgK,cAYrB,yBAAKvJ,UAAWT,EAAQiK,cAAeZ,GAExCvE,GAAqB3H,EAAS8B,KAAO6F,GACpC,kBAAC,GAAD,CAAgB3H,SAAUA,EAAU5H,UAAWA,UAS3D,qEAGDmU,GAuDP,SAASV,GAAT,GAKI,IAJF3D,EAIC,EAJDA,kBACAkB,EAGC,EAHDA,WACAd,EAEC,EAFDA,oBAKMyE,GAHL,EADDjB,2BAEgBhJ,KAQZ,+CACW,IACT,kBAACkK,GAAD,CAAMxV,MAAO4R,EAAY6D,MAAM,cAAcC,WAAW,MAIxDC,EAKF,oCACE,kBAACH,GAAD,CACExV,MAAO8Q,EACP2E,MAAM,iCAENC,WAAW,KAKnB,OACE,kBAACE,EAAA,EAAD,CAAYC,QAAQ,KAAK3H,MAAM,UAAU4H,MAAO,CAAE9G,WAAY,MAA9D,kBACiB,kBAACwG,GAAD,CAAMxV,MAAO0Q,EAAmB+E,MAAM,gBADvD,IACyE,IACtEF,EAFH,QAEmBI,EAFnB,KAQJ,SAASH,GAAT,GAA4D,IAAD,IAA3CxV,aAA2C,MAAnC,EAAmC,MAAhCyV,aAAgC,MAAxB,GAAwB,MAApBC,iBAAoB,SACzD,OACE,8BACa,IAAV1V,GACC,kBAAC4V,EAAA,EAAD,CACEC,QAAQ,KACRE,UAAU,OACV7H,MAAM,YACN4H,MAAO,CAAE9G,WAAY,MAEpBhP,EAAO,KAGZ,kBAAC4V,EAAA,EAAD,CAAYC,QAAQ,KAAKE,UAAU,OAAOD,MAAO,CAAE9G,WAAY,MAClD,IAAVhP,GAAe,MACfyV,EACCC,GAAuB,IAAV1V,EAAmB,IAAL,KAM9B,SAASgW,KACd,IAAM3K,EAAUC,KAEhB,OACE,yBAAKQ,UAAWT,EAAQU,MACtB,yBAAKD,UAAWT,EAAQuI,YACtB,kBAACqC,GAAA,EAAD,CAAUnG,MAAM,MAAMC,OAAO,UAG/B,yBAAKjE,UAAWT,EAAQ+I,OACtB,kBAAC6B,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,WAC9B,kBAACkG,GAAA,EAAD,CAAUnG,MAAM,MAAMC,OAAO,WAC7B,wBAAIjE,UAAWT,EAAQkJ,WACrB,kBAAC0B,GAAA,EAAD,CAAUnG,MAAM,MAAMC,OAAO,aAIjC,kBAACkG,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,SAE9B,wBAAIjE,UAAWT,EAAQoJ,eACrB,wBAAI3I,UAAWT,EAAQ8J,mBACrB,yBAAKrJ,UAAWT,EAAQqJ,gBACtB,0BAAM5I,UAAWT,EAAQuJ,gBACvB,kBAACqB,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,UAEhC,0BAAMjE,UAAWT,EAAQwJ,cACvB,kBAACoB,GAAA,EAAD,CAAUnG,MAAM,MAAMC,OAAO,UAG/B,yBAAKjE,UAAWT,EAAQyJ,eACtB,kBAACmB,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,OAAO+F,MAAO,CAAE9F,YAAa,KAC3D,kBAACiG,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,YAKpC,wBAAIjE,UAAWT,EAAQ8J,mBACrB,yBAAKrJ,UAAWT,EAAQqJ,gBACtB,0BAAM5I,UAAWT,EAAQuJ,gBACvB,kBAACqB,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,UAEhC,0BAAMjE,UAAWT,EAAQwJ,cACvB,kBAACoB,GAAA,EAAD,CAAUnG,MAAM,MAAMC,OAAO,UAG/B,yBAAKjE,UAAWT,EAAQyJ,eACtB,kBAACmB,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,OAAO+F,MAAO,CAAE9F,YAAa,KAC3D,kBAACiG,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,YAKpC,wBAAIjE,UAAWT,EAAQ8J,mBACrB,yBAAKrJ,UAAWT,EAAQqJ,gBACtB,0BAAM5I,UAAWT,EAAQuJ,gBACvB,kBAACqB,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,UAEhC,0BAAMjE,UAAWT,EAAQwJ,cACvB,kBAACoB,GAAA,EAAD,CAAUnG,MAAM,MAAMC,OAAO,UAG/B,yBAAKjE,UAAWT,EAAQyJ,eACtB,kBAACmB,GAAA,EAAD,CAAUnG,MAAM,OAAOC,OAAO,cAlI5CG,GAAcgG,YAAc,wBA4C5B7B,GAAa6B,YAAc,qCAiG3B,IAAM5K,GAAYmC,aAAW,SAACC,GAAD,MAAY,CACvC3B,KAAM,CACJ4B,QAASD,EAAME,QAAQ,EAAG,GAC1BuI,SAAUzI,EAAM0I,YAAYC,OAAOC,GACnC/G,SAAU,GAGZqE,WAAY,CACVxE,QAAS,OACTmH,cAAe,MACfC,eAAgB,WAChBxI,aAAcN,EAAME,QAAQ,IAG9BiG,YAAa,CACXzE,QAAS,OACTC,WAAY,SACZnB,MAAOR,EAAMU,QAAQW,KAAK,KAC1BH,SAAUlB,EAAMG,WAAWgB,QAAQ,KAGrC0F,UAAU,2BACL7G,EAAMG,WAAWiB,WADb,IAEPE,WAAYtB,EAAMG,WAAWoB,gBAC7BlB,OAAQ,EACR0I,UAAW/I,EAAME,QAAQ,KACzBM,MAAOR,EAAMU,QAAQC,QAAQoB,MAE7B,SAAU,CACRvB,MAAOR,EAAMU,QAAQC,QAAQoB,MAC7BT,WAAY,UAIhBoF,MAAO,CACLpG,aAAcN,EAAME,QAAQ,IAG9BkG,cAAe,CACb1E,QAAS,OACTC,WAAY,SACZW,YAAatC,EAAME,QAAQ,KAG7BmG,WAAY,CACVjE,MAAO,GACPC,OAAQ,GACRC,YAAatC,EAAME,QAAQ,IAC3B8I,KAAMhJ,EAAMU,QAAQuI,UAAUrI,MAGhC0F,UAAU,eACLtG,EAAMG,WAAW+I,SAGtB3C,YAAa,CACXnE,MAAO,GACPC,OAAQ,GACRC,YAAatC,EAAME,QAAQ,KAG7BiJ,YAAa,GAEbrC,gBAAgB,2BACX9G,EAAMG,WAAWI,UADP,IAEbC,MAAO,UACPQ,aAAa,sBAGf+F,cAAe,CACb1G,OAAQL,EAAME,QAAQ,GAAI,GAC1BD,QAAS,EACTgB,cAAe,QAGjBmI,eAAgB,GAEhB3B,kBAAmB,CACjB,mBAAoB,CAClBxH,QAASD,EAAME,QAAQ,EAAG,KAI9ByH,aAAc,CACZjG,QAAS,OACTmH,cAAe,SACfQ,gBAAiB,sBACjBC,UAAW,OAEXC,WAAY,kBACZC,WAAY,gCAEZ,eAAgB,CACdnJ,OAAQL,EAAME,QAAQ,EAAG,GACzBoJ,UAAWtJ,EAAMyJ,QAAQ,GACzBJ,gBAAiB,wBAIrBzB,aAAc,CACZ/F,SAAU,EACV5B,QAASD,EAAME,QAAQ,EAAG,GAC1BwJ,eAAgB,OAChBlJ,MAAO,UAEP,UAAW,CACT6I,gBAAiBrJ,EAAMU,QAAQW,KAAK,MAGtC,eAAgB,CACdgI,gBAAiB,cACjBpJ,QAAS,EAET,UAAW,CACToJ,gBAAiB,iBAKvBrC,eAAgB,CACdtF,QAAS,OACTiI,oBAAqB,8BACrBC,cAAe5J,EAAME,QAAQ,GAC7ByB,WAAY,SACZ1B,QAASD,EAAME,QAAQ,EAAG,GAI1BqJ,WAAY,UACZC,WAAY,wBAEZ,eAAgB,CACdvJ,QAASD,EAAME,QAAQ,EAAG,KAM9BgH,eAAgB,CACdjH,QAASD,EAAME,QAAQ,IACvB2B,SAAU,EACVC,WAAY,EACZ+H,aAAc7J,EAAM8J,MAAMD,aAE1BvI,WAAYtB,EAAMG,WAAW4J,kBAE7B,oBAAqB,CACnBC,QAAS,KAIb7C,aAAc,CACZjG,SAAUlB,EAAMG,WAAWgB,QAAQ,IACnCX,MAAOR,EAAMU,QAAQC,QAAQC,KAE7B,oBAAqB,CACnBoJ,QAAS,GACTC,UAAW,WAIf7C,cAAe,CACb1F,QAAS,QAGX4F,aAAc,CACZzF,SAAU,EACVC,WAAY,EAEZO,OAAQrC,EAAME,QAAQ,GACtBD,QAASD,EAAME,QAAQ,EAAG,GAC1BoC,YAAatC,EAAME,QAAQ,GAE3B2J,aAAc7J,EAAME,QAAQ,KAC5BgB,SAAUlB,EAAMG,WAAWgB,QAAQ,IACnC+I,WAAW,GAAD,OAAKlK,EAAME,QAAQ,GAAnB,MAEV,aAAc,CACZgB,SAAUlB,EAAMG,WAAWgB,QAAQ,KAGrC,oBAAqB,CACnB6I,QAAS,KAIbG,kBAAmB,CACjBnI,WAAYvB,IAAMT,EAAMU,QAAQjO,MAAMsP,OAAOjB,QAAQ,IAAKC,MAE1DP,MAAOC,IAAMT,EAAMU,QAAQjO,MAAMyP,MAAMC,OAAO,IAAKpB,OAGrDwG,wBAAyB,CACvBvF,WAAYvB,IAAMT,EAAMU,QAAQ0J,QAAQrI,OAAOjB,QAAQ,IAAKC,MAC5DP,MAAOC,IAAMT,EAAMU,QAAQ0J,QAAQlI,MAAMC,OAAO,IAAKpB,OAGvDyG,sBAAuB,CACrBxF,WAAYvB,IAAMT,EAAMU,QAAQ2J,QAAQtI,OAAOjB,QAAQ,IAAKC,MAC5DP,MAAOC,IAAMT,EAAMU,QAAQ2J,QAAQnI,MAAMC,OAAO,IAAKpB,OAIvDjD,UAAW,OAKP6E,GAAsB5C,aAAW,SAACC,GACtC,IAAMsK,EAAO,CACX9J,MAAO,QAGT,MAAO,CAAC,MAAO,OAAQ,MAAO,QAAS,UAAU2D,QAC/C,SAACoG,EAAQ3T,GACP,IAAM4J,EAAQR,EAAMU,QAAQ8J,YAAY5T,GAKxC,OAJA2T,EAAO3T,GAAP,2BACK0T,GADL,IAEEjB,gBAAiB7I,EAAM0B,OAElBqI,IAET,OAIErH,GAAmB1N,cAAYC,IAAIC,SAAS+U,SCvnBnC,gBAAU/P,GACmBA,EAAlCgQ,KADuB,IACjBC,EAA4BjQ,EAA5BiQ,SAAahQ,EADG,YACYD,EADZ,qBAG9B,OACE,qCACEgQ,KAAK,6CACLE,OAAO,UACHjQ,GAEHgQ,I,uCCOQ,SAASE,GAAT,GAGX,IAFFC,EAEC,EAFDA,iBACAC,EACC,EADDA,kBAEMpN,EAAUC,KADf,EAE4C7E,GAC3C,SAACI,GAAD,OAAaA,EAAQ6R,iBACrB,IAFMvR,EAFP,EAEOA,QAAShH,EAFhB,EAEgBA,MAAeuB,EAF/B,EAEuB0F,OAKlBuR,EAAgBhQ,mBAAQ,kBA2WhC,SAA6BiQ,GAC3B,IAAMlX,EAAWkX,EAAY7W,KAAI,SAAC8W,GAChC,IAAM7W,EAAY6Q,YAAagG,EAAO7W,WAChCC,EAAY4W,EAAO5W,WAAa4Q,YAAagG,EAAO5W,WACpDC,EAAc2W,EAAO3W,aAAe2Q,YAAagG,EAAO3W,aACxD4W,GAAY5W,EAElB,OAAO,2BACF2W,GADL,IAEEC,WACA9W,YACAC,YACAC,mBAIE6W,EAAkBC,KAAQtX,GAAU,SAACW,GAAD,OACxCA,EAAQyW,SAAW,SAAW,eAE1BG,EAAS1G,IACbwG,EAAe,QAAc,IAC7B,SAAC1W,GAAD,OAAcA,EAAQL,aAElBkX,EAAY3G,IAChBwG,EAAe,WAAiB,IAChC,SAAC1W,GAAD,OAAcA,EAAQH,eAGxB,MAAO,CAAE+W,SAAQC,aAvYmBC,CAAoBzX,GAAY,MAAK,CACvEA,IAEI0X,EAAmBzQ,mBAAQ,iBAwY1B,CACLsQ,OAAQI,MAAMC,KAAK,CAAEzP,OAAQ,IAAK,SAAC0P,EAAGC,GAAJ,OAAUA,KAC5CN,UAAWG,MAAMC,KAAK,CAAEzP,OAAQ,IAAK,SAAC0P,EAAGC,GAAJ,OAAUA,QA1YiB,IAQlE,OANA/R,qBAAU,WACJN,GAAWhH,GAEfsY,EAAkB,GAAD,oBAAKE,EAAcM,QAAnB,aAA8BN,EAAcO,eAC5D,CAAC/R,EAAShH,EAAOwY,IAGlB,yBAAK7M,UAAWT,EAAQoO,UACpBtS,GAAWwR,EAAcM,OAAOpP,OAAS,IACzC,yBAAKiC,UAAWT,EAAQqO,gBACrBvS,EACC,wBAAI2E,UAAWT,EAAQsO,cACpBP,EAAiBH,OAAOlX,KAAI,SAACyX,GAAD,OAC3B,wBAAIjN,IAAKiN,EAAG1N,UAAWT,EAAQuO,iBAC7B,kBAACC,GAAD,CAAmBL,EAAGA,SAK5B,wBAAI1N,UAAWT,EAAQsO,cACpBhB,EAAcM,OAAOlX,KAAI,SAAC+X,GAAD,OACxB,wBACEvN,IAAKuN,EAAclZ,UACnBkL,UAAWT,EAAQuO,iBAEnB,kBAACG,GAAD,CACE1X,QAASyX,EACTtO,UACEgN,GACAsB,EAAclZ,YAAc4X,WAU1CrR,GAAWwR,EAAcO,UAAUrP,OAAS,IAC5C,6BACG1C,EACC,wBAAI2E,UAAWT,EAAQsO,cACpBP,EAAiBF,UAAUnX,KAAI,SAACyX,GAAD,OAC9B,wBAAIjN,IAAKiN,EAAG1N,UAAWT,EAAQuO,iBAC7B,kBAACI,GAAD,CAAsBR,EAAGA,SAK/B,wBAAI1N,UAAWT,EAAQsO,cACpBhB,EAAcO,UAAUnX,KAAI,SAACkY,GAAD,OAC3B,wBACE1N,IAAK0N,EAAgBrZ,UACrBkL,UAAWT,EAAQuO,iBAEnB,kBAACM,GAAD,CACE7X,QAAS4X,EACTzO,UACEgN,GACAyB,EAAgBrZ,YAAc4X,WAYpD,SAASuB,GAAc3R,GAAQ,IACrB/F,EAAY+F,EAAZ/F,QACAF,EAASE,EAATF,KACFkJ,EAAUC,KACV6O,EAASvO,GAAmBxD,EAAMoD,WAElCyG,EAAa9P,EAAKG,MAAK,kBAAuB,YAAvB,EAAGF,QAC1B8P,EACJ/P,EAAKG,MAAK,kBAAuB,oBAAvB,EAAGF,SAA0C,UACnDoR,EAAM,IAAIC,KAEhB,OACE,kBAAC2G,GAAD,CAAgB/X,QAASA,EAASmJ,UAAWpD,EAAMoD,WACjD,kBAAC4J,EAAA,EAAD,CAAMtJ,UAAW6I,IAAWtJ,EAAQgP,KAAMhP,EAAQyN,UAAWjN,IAAKsO,GAChE,wBAAIrO,UAAWT,EAAQkJ,WAAvB,SACQ,0BAAMzI,UAAWT,EAAQgH,SAAUJ,EAAWjS,OADtD,MACuE,IACrE,8BAAOkS,EAAOlS,QAGhB,yBAAK8L,UAAWT,EAAQwI,aACtB,yBAAK/H,UAAWT,EAAQyI,eACtB,kBAAC,IAAD,CAAuBhI,UAAWT,EAAQ0I,aAC1C,0BAAMjI,UAAWT,EAAQ2I,WAAzB,SAHJ,SAKSE,YAAmB7R,EAAQL,UAAWwR,MAOvD,SAAS0G,GAAiB9R,GAAQ,IACxB/F,EAAY+F,EAAZ/F,QACAF,EAASE,EAATF,KACFkJ,EAAUC,KACV6O,EAASvO,GAAmBxD,EAAMoD,WAElCyG,EAAa9P,EAAKG,MAAK,kBAAuB,YAAvB,EAAGF,QAC1B8P,EAAS/P,EAAKG,MAAK,kBAAuB,oBAAvB,EAAGF,QACtBoR,EAAM,IAAIC,KAEhB,OACE,kBAAC2G,GAAD,CAAgB/X,QAASA,GACvB,kBAAC+S,EAAA,EAAD,CAAMtJ,UAAW6I,IAAWtJ,EAAQgP,KAAMhP,EAAQiP,aAChD,yBAAKxO,UAAWT,EAAQkJ,UAAW1I,IAAKsO,GAAxC,SACQ,8BAAOlI,EAAWjS,OAD1B,OAC2C,8BAAOkS,EAAOlS,QAGzD,yBAAK8L,UAAWT,EAAQwI,aACtB,kBAAC,IAAD,CAAc/H,UAAWT,EAAQ4I,cADnC,SAESC,YAAmB7R,EAAQH,YAAasR,GAFjD,SAE6D,IAC1DW,YAAmB9R,EAAQH,YAAaG,EAAQL,cAO3D,SAASoY,GAAehS,GAAQ,IACtB/F,EAAY+F,EAAZ/F,QACFgJ,EAAUC,KAEhB,OACE,kBAACnD,GAAD,CACE2D,UAAWT,EAAQkP,QACnB3Z,UAAWyB,EAAQzB,UACnB4Z,gBAAiBnP,EAAQG,WAExBpD,EAAMiQ,UAKb,SAASwB,KACP,IAAMxO,EAAUC,KAEhB,OAAO,kBAAC2K,GAAA,EAAD,CAAUJ,QAAQ,OAAO/J,UAAWT,EAAQoP,iBAGrD,SAAST,KACP,IAAM3O,EAAUC,KAEhB,OACE,yBAAKQ,UAAWT,EAAQoP,gBACtB,kBAACxE,GAAA,EAAD,CACEJ,QAAQ,OACR/F,MAAM,MACNC,OAAO,SACPjE,UAAWT,EAAQqP,qBAErB,kBAACzE,GAAA,EAAD,CACEJ,QAAQ,OACR/F,MAAM,MACNC,OAAO,OACPjE,UAAWT,EAAQqP,sBAM3B,SAAS9O,GAAmBJ,GAC1B,IAAMmP,EAAU5T,mBAehB,OAdAU,qBAAU,WACR,GAAK+D,EAAL,CAEA,IAAKmP,EAAQzT,QACX,MAAMpH,MACJ,+EAGJ2L,aAAekP,EAAQzT,QAAS,CAC9BwE,WAAY,YACZC,MAAO,cAER,CAACH,IAEGmP,EAMT,IAAMrP,GAAYmC,aAAW,SAACC,GAAD,YAAY,CACvC+L,QAAS,CACP9L,QAASD,EAAME,QAAQ,GACvB2B,SAAU,EACVqL,SAAU,QACV9K,MAAO,UACPC,OAAQ,QACR8K,UAAW,SAEXC,YAAY,aAAD,OAAepN,EAAMU,QAAQW,KAAK,MAC7CW,WAAYhC,EAAMU,QAAQW,KAAK,MAGjC2K,eAAgB,CACd1L,aAAcN,EAAME,QAAQ,IAG9B+L,aAAc,CACZpK,SAAU,EACVxB,OAAQ,EACRJ,QAAS,EACTgB,cAAe,QAGjBiL,gBAAiB,GAEjBW,QAAS,CACPnD,eAAgB,QAGlBqD,eAAgB,CACd1K,OAAQ,OACR/B,aAAcN,EAAME,QAAQ,IAG9B8M,mBAAoB,CAClB1M,aAAcN,EAAME,QAAQ,MAG9ByM,MAAI,GACFjL,QAAS,OACTmH,cAAe,SACflH,WAAY,aACZ1B,QAASD,EAAME,QAAQ,GACvBI,aAAcN,EAAME,QAAQ,KAC5BoJ,UAAW,uCAEXC,WAAY,qCACZ8D,UAAW,gBACX7D,WACE,iFAXA,cAaD,eAAiB,CAChBH,gBAAiB,cACjBC,UAAW,SAfX,cAmBD,qCAAuC,CACtCA,UAAW,uCACXU,QAAS,IArBT,cAyBD,uBAAyB,CACxBvI,WAAW,aAAD,OAAezB,EAAMU,QAAQ4M,QAAQ1M,MAC/CoJ,QAAS,EACTqD,UAAU,cAAD,OAAgBrN,EAAME,QAAQ,GAA9B,OACToJ,UAAW,CACT,uCACA,2CACAiE,KAAK,KACPvL,WAAY,SAjCZ,GAsCJ4K,WAAY,GACZ9O,UAAW,GACXsN,SAAU,GAEVvE,UAAW,CACT,SAAU,CACRrG,MAAOR,EAAMU,QAAQC,QAAQoB,OAG/B,cAAc,2BACT/B,EAAMG,WAAWqN,WADtB,IAEElM,WAAYtB,EAAMG,WAAWoB,gBAC7BlB,OAAQ,EACRC,aAAcN,EAAME,QAAQ,KAE5B,SAAU,CACRoB,WAAY,OACZJ,SAAUlB,EAAMG,WAAWiB,UAAUF,aAK3CiF,YAAa,CACXzE,QAAS,OACTC,WAAY,SACZnB,MAAOR,EAAMU,QAAQW,KAAK,KAC1BH,SAAUlB,EAAMG,WAAWgB,QAAQ,KAGrCiF,cAAe,CACb1E,QAAS,OACTC,WAAY,SACZW,YAAatC,EAAME,QAAQ,KAG7BmG,WAAY,CACVjE,MAAO,GACPC,OAAQ,GACRC,YAAatC,EAAME,QAAQ,IAC3B8I,KAAMhJ,EAAMU,QAAQuI,UAAUrI,MAGhC0F,UAAU,eACLtG,EAAMG,WAAW+I,SAGtB3C,YAAa,CACXnE,MAAO,GACPC,OAAQ,GACRC,YAAatC,EAAME,QAAQ,KAG7BsE,OAAQ,CACN9C,QAAS,OACToH,eAAgB,SAEhB5H,SAAUlB,EAAMG,WAAWgB,QAAQ,KAGrCsM,WAAY,CACV/L,QAAS,OACTC,WAAY,SACZU,OAAQrC,EAAME,QAAQ,KACtB8B,WAAYhC,EAAMU,QAAQW,KAAK,KAC/BqM,OAAO,aAAD,OAAe1N,EAAMU,QAAQW,KAAK,MACxCsM,oBAAqB,EACrBC,uBAAwB,EACxBC,YAAa7N,EAAME,QAAQ,GAC3B4N,aAAc9N,EAAME,QAAQ,IAG9B6N,UAAW,CACTrM,QAAS,OACTC,WAAY,SACZU,OAAQrC,EAAME,QAAQ,KACtB2N,YAAa7N,EAAME,QAAQ,GAC3B4N,aAAc9N,EAAME,QAAQ,GAC5B8N,qBAAsB,EACtBC,wBAAyB,EACzBjM,WAAYhC,EAAMU,QAAQC,QAAQoB,MAClCvB,MAAO,Y,4CCzXI,SAAS0N,KACtB,IAAMvQ,EAAUC,KAEhB,OACE,kBAAC8J,EAAA,EAAD,CAAMtJ,UAAWT,EAAQwQ,OACvB,kBAACC,GAAA,EAAD,CAAWhQ,UAAWT,EAAQ0Q,aAAcC,MAAOC,OAEnD,0EAEA,0MASN,IAAM3Q,GAAYmC,aAAW,SAACC,GAAD,YAAY,CACvCmO,OAAK,GACH/L,MAAO,OACPnC,QAASD,EAAME,QAAQ,EAAG,IAFvB,cAIFF,EAAM0I,YAAY8F,GAAG,MAAQ,CAC5BpM,MAAQpC,EAAM0I,YAAYC,OAAO8F,GAAK,EAAK,IAL1C,cAQH,OARG,2BASEzO,EAAMG,WAAWuO,IATnB,IAUDxN,SAAUlB,EAAMG,WAAWwO,GAAGzN,SAC9BV,MAAOR,EAAMU,QAAQC,QAAQC,KAC7BP,OAAQL,EAAME,QAAQ,EAAG,EAAG,MAZ3B,cAeH,MAfG,2BAgBEF,EAAMG,WAAWqN,WAhBnB,IAiBDlM,WAAYtB,EAAMG,WAAWoB,mBAjB5B,GAqBL8M,aAAc,CACZhM,OAAQ,IACRhC,OAAQL,EAAME,SAAS,GAAI,EAAG,GAC9B0O,eAAgB,QAChBC,mBAAoB,kBCxBlBC,GAAqBhd,SAEZ,SAASid,GAAqBrU,GAAQ,IAC3CsU,EAAmBtU,EAAnBsU,MAAO7V,EAAYuB,EAAZvB,QACT8V,IAAe9V,EACfqB,EAAUwU,EAAME,IAChBvR,EAAUC,KACVuR,EAAcC,eAEdtE,EAAmB7P,mBAAQ,WAC/B,IAAMoU,EAAeC,YACnB5U,EAAM6U,SAASC,SACfL,EAAYM,gBAGd,OAAOJ,GAAgBA,EAAaK,OAAOxc,YAC1C,CAACwH,EAAM6U,SAASC,SAAUL,EAAYM,iBAEnCE,EAAmB1U,mBAAQ,iBP5B1B,CAAE9B,SADJ,EO6BgD,CAAEA,UAASqB,YP7BlCrB,QACZqB,QADgC,EAAXA,SAAlC,QO6BuE,CAC1EyU,EACAzU,IAlBgD,EAqBVoV,mBAASd,IArBC,mBAqB3Ce,EArB2C,KAqB7BC,EArB6B,KAsB5C/E,EAAoBvF,uBAAY,SAACxR,GACjCA,GAAYA,EAASmI,OAAS,GAClC2T,EAAgB9b,GAAYA,EAAS,OAEjC+b,EAAcF,IAAiBf,MAAwBe,EAE7D,OAAKZ,EAKH,kBAAC,EAAD,CAAiC3c,MAAOqd,GACtC,kBAACK,EAAA,EAAD,CAAMC,MAAM,8BACV,kBAACD,EAAA,EAAKE,OAAN,CAAaC,MAAM,IAEnB,kBAACH,EAAA,EAAKI,KAAN,CAAWC,QAAQ,GACjB,yBACEjS,UAAWI,IAAWb,EAAQU,KAAT,eAClBV,EAAQ2S,SAAWP,KAGtB,yBAAK3R,UAAWT,EAAQ4S,qBACtB,kBAAC1F,GAAD,CACEC,iBAAkBA,EAClBC,kBAAmBA,KAItBgF,EACC,yBAAK3R,UAAWT,EAAQ6S,iBACtB,kBAAC,IAAD,KACE,kBAAC,IAAD,CACEC,QAAM,EACN7Y,KAAMuX,EAAYuB,uBAClBrI,UAAWsI,KAEb,kBAAC,IAAD,CACEF,QAAM,EACN7Y,KAAMuX,EAAYM,eAClBpH,UAAWsI,KAEZd,IAAiBf,IAAsBe,EACtC,kBAAC,IAAD,CACElK,SAAO,EACP/K,GAAE,UAAKJ,EAAL,qBAAyBqV,EAAa3c,aAG1C,kBAACoV,GAAD,QAKN,kBAACsI,GAAD,CAAuB9T,UAAU,8CA7CpC,kBAAC+T,EAAA,EAAD,MAsDJ,SAASC,KACd,OACE,kBAACd,EAAA,EAAD,CAAMC,MAAM,8BACV,kBAACD,EAAA,EAAKE,OAAN,CAAaC,MAAM,IAEnB,kBAACH,EAAA,EAAKI,KAAN,CAAWC,QAAQ,GACjB,kBAACO,GAAD,QAMR,SAASA,GAAT,GAA+C,IAAd9T,EAAa,EAAbA,UACzBa,EAAUC,KAIhB,OAFKd,IAAWA,EAAY,iDAG1B,yBAAKsB,UAAWT,EAAQoT,OACtB,yBAAK3S,UAAWT,EAAQqT,mBACtB,4BAAKlU,GAEL,yFAC8D,IAC5D,kBAACmU,GAAD,+BAFF,KAKA,yEAC8C,IAC5C,uBAAGvG,KAAMwG,KAAA,mBAAiCpU,KAA1C,uBAFF,MASF,kBAACoR,GAAD,OAKC,SAASyC,GAAiBjW,GAAQ,IAAD,EACJA,EAAMsU,MAAMU,OAAtCxc,EAD8B,EAC9BA,UAAWsQ,EADmB,EACnBA,WADmB,EAOlCzK,GAAkB,SAACI,GAAD,OAAaA,EAAQgY,WAAWje,KAAY,CAChEA,IALSke,EAH2B,EAGpC3X,QACQ5D,EAJ4B,EAIpC6D,OACO2X,EAL6B,EAKpC5e,MACU6e,EAN0B,EAMpC3X,SANoC,EAqFxC,SAAiBzG,GAAY,IAAD,EACkB6F,GAC1C,SAACI,GAAD,OAAaA,EAAQoY,eAAere,KACpC,CAACA,IAFase,EADU,EAClB9X,OAAuB+X,EADL,0BAMpBpe,EAAO4H,mBAAQ,WACnB,OAAKuW,EAuGT,SAAoBA,GAAa,IACvBxc,EAAYF,EAAkB0c,GAA9Bxc,QAGR,OAFa0c,YAAiB1c,GAvGrB2c,CAAWH,GAFM,OAGvB,CAACA,IAIJ,OAAO,2BAAKC,GAAZ,IAAsB/X,OAAQrG,IAzFmCue,CAC/D1e,GADe2e,EAVqB,EAU9BpY,QAA8BpG,EAVA,EAURqG,OAAqBoY,EAVb,EAUMrf,MAVN,EAkBlCsG,GAAkB,SAACI,GAAD,OAAaA,EAAQ4Y,YAAY7e,KAAY,CACjEA,IALS6Z,EAd2B,EAcpCtT,QACQ9E,EAf4B,EAepC+E,OACOsY,EAhB6B,EAgBpCvf,MACUwf,EAjB0B,EAiBpCtY,SAjBoC,EA2BlCZ,GACF,SAACI,GAAD,OAAaA,EAAQ+Y,0BAA0Bhf,KAC/C,CAACA,IANQif,EAvB2B,EAuBpC1Y,QACQmM,EAxB4B,EAwBpClM,OACO0Y,EAzB6B,EAyBpC3f,MACU4f,EA1B0B,EA0BpC1Y,SAMIlH,EACJ4e,GAAeS,GAAaE,GAAgBI,EAC9C,GAAI3f,EAAO,MAAMA,EAKjB,OAFE6e,GAAkBW,GAAmBI,EAG9B,kBAACC,GAAD,MAIP,qCACIlB,GACAS,GACA9E,GACAoF,IAAiC,kBAAC7J,GAAD,MAElCzS,GAAUxC,GAAQsB,GAAWiR,GAC5B,kBAACpD,GAAD,CACE3M,OAAQA,EACRxC,KAAMA,EACNsB,QAASA,EACT8N,kBAAmBe,EACnBoC,sBAAuBA,KAOjC,SAAS0M,GAAe5X,GACtB,IAAMiD,EAAUC,KAChB,OACE,yBAAKQ,UAAWT,EAAQhE,UACtB,sFAEA,4HAKA,yEAC8C,IAC5C,uBAAG+Q,KAAMwG,KAAqB,8BAA9B,uBAFF,MA+BN,IAAMtT,GAAYmC,aAAW,SAACC,GAAD,gBAAY,CACvC3B,MAAI,GACFqD,QAAS,OACTG,SAAU,GAFR,cAGD7B,EAAM0I,YAAY6J,KAAK,MAAQ,CAC9B1J,cAAe,WAJf,cAMD7I,EAAM0I,YAAY8F,GAAG,MAAQ,CAC5B3F,cAAe,QAPf,GAWJyH,QAAS,GAETC,qBAAmB,GAEjBnO,MAAO,OACPP,SAAU,EACVC,WAAY,EACZJ,QAAS,QALQ,cAOhB1B,EAAM0I,YAAY8F,GAAG,MAAQ,CAC5BpM,MAAQpC,EAAM0I,YAAYC,OAAO6J,GAAK,EAAK,IAR5B,cAWjB,aAAc,CACZ9Q,QAAS,SAZM,GAenB8O,gBAAiB,CACf9O,QAAS,OACTG,SAAU,EACVC,WAAY,EACZgH,eAAgB,UAGlBiI,MAAM,aACJlP,SAAU,EACVH,QAAS,OACTmH,cAAe,SACfC,eAAgB,SAChBnH,WAAY,UAEX3B,EAAM0I,YAAY6J,KAAK,MAAQ,CAC9BtS,QAASD,EAAME,QAAQ,EAAG,KAI9B8Q,mBAAiB,GACf5O,MAAO,OACP9B,aAAcN,EAAME,QAAQ,IAFb,cAIdF,EAAM0I,YAAY8F,GAAG,MAAQ,CAC5BvO,QAASD,EAAME,QAAQ,EAAG,GAC1BkC,MAAQpC,EAAM0I,YAAYC,OAAO8F,GAAK,EAAK,IAN9B,cASf,OATe,2BAUVzO,EAAMG,WAAWwO,IAVP,IAWbnO,MAAOR,EAAMU,QAAQC,QAAQC,QAXhB,cAcf,MAde,2BAeVZ,EAAMG,WAAWsS,OAfP,IAiBbnR,WAAYtB,EAAMG,WAAWoB,mBAjBhB,GAqBjB5H,SAAU,CACRsG,QAASD,EAAME,QAAQ,EAAG,GAE1B,OAAO,2BACFF,EAAMG,WAAWwO,IADtB,IAEEnO,MAAOR,EAAMU,QAAQC,QAAQC,OAG/B,MAAM,2BACDZ,EAAMG,WAAWsS,OADtB,IAGEnR,WAAYtB,EAAMG,WAAWoB,uB,2CClUtBmR,GAAb,WAIE,WACUC,EACAnY,GACP,yBAFOmY,iBAER,KADQnY,UACR,KANMoY,eAMN,OALMC,gBAKN,EACA3gB,KAAK4gB,cART,6FAYIlb,GAZJ,8FAaImb,EAbJ,+BAa2B,GAEjBtf,EAAU,IAAIuf,QAAQD,EAAQtf,SAAW,IACvCmf,EAAc1gB,KAAd0gB,UAEF1D,EAAM+D,KAAQ/gB,KAAKsI,QAAS5C,GAE7Bgb,EApBT,gCAqBY1gB,KAAK4gB,cArBjB,cAwBIrf,EAAQyf,IAAI,gBAAZ,iBAAuChhB,KAAK0gB,YAxBhD,UA0B2Bpf,MAAM0b,EAAD,YAAC,eACxB6D,GADuB,IAE1Btf,aA5BN,eA0BUG,EA1BV,QA+BkBjB,IAA0B,MAApBiB,EAASuf,QAC3BjhB,KAAK4gB,cAhCX,kBAmCWlf,GAnCX,0QAuCS1B,KAAK2gB,aACFO,EADc,uCACJ,8BAAAngB,EAAA,sEACS,EAAK0f,iBADd,WACR/e,EADQ,QAGAjB,GAHA,sBAIN,IAAIP,MACR,sEALU,uBAQQwB,EAASC,OARjB,WAQRwG,EARQ,QASDuY,UATC,uBAUN,IAAIxgB,MACR,qEAXU,QAcd,EAAKwgB,UAAYvY,EAAQuY,UACzB,EAAKC,WAAa,KAfJ,4CADI,qDAmBpB3gB,KAAK2gB,WAAaO,KA1DxB,kBA6DWlhB,KAAK2gB,YA7DhB,6QAiE2B3gB,KAAKmhB,QAAQ,aAjExC,WAiEUzf,EAjEV,QAmEkBjB,GAnElB,sBAmE4B,IAAIP,MAAM,yCAnEtC,uBAqE0BwB,EAASC,OArEnC,cAqEUwG,EArEV,yBAuEW1H,EAAG0H,EAAQrG,WAvEtB,iLA0EoBd,GA1EpB,yFA2E2BhB,KAAKmhB,QAAL,oBAA0BngB,IA3ErD,WA2EUU,EA3EV,QA6EkBjB,GA7ElB,mBA8E8B,MAApBiB,EAASuf,OA9EnB,yCA+EevgB,EAAI,IAAIb,IA/EvB,aAiFc,IAAIK,MAAM,gCAjFxB,wBAqF0BwB,EAASC,OArFnC,eAqFUwG,EArFV,yBAuFW1H,EAAG0H,IAvFd,kLA0FmBnH,GA1FnB,+FA2F2BhB,KAAKmhB,QAAL,oBACRngB,EADQ,sBA3F3B,WA2FUU,EA3FV,QA+FkBjB,GA/FlB,mBAgG8B,MAApBiB,EAASuf,OAhGnB,yCAiGevgB,EAAI,IAAIb,IAjGvB,aAmGc,IAAIK,MAAM,mDAnGxB,wBAuG0BwB,EAASC,OAvGnC,eAuGUwG,EAvGV,OAwGUiZ,EAAe9d,cAAYgB,+BAA+BD,OAC9D8D,GAEI9E,EAAY,IAAIC,cAAYC,IAAIC,SAASC,wBAC7CC,gBAEIc,EAAmBnB,EAAUa,KAAKkd,GA9G5C,kBA+GW3gB,EAAG+D,IA/Gd,iMAmHIxD,GAnHJ,yFAqH2BhB,KAAKmhB,QAAL,oBACRngB,EADQ,+BArH3B,WAqHUU,EArHV,QAyHkBjB,GAzHlB,mBA0H8B,MAApBiB,EAASuf,OA1HnB,yCA2HevgB,EAAI,IAAIb,IA3HvB,aA6Hc,IAAIK,MACR,2DA9HV,wBAmI0BwB,EAASC,OAnInC,eAmIUwG,EAnIV,yBAoIW1H,EAAG0H,IApId,sLAwIInH,GAxIJ,yFA0I2BhB,KAAKmhB,QAAL,oBAA0BngB,EAA1B,UA1I3B,WA0IUU,EA1IV,QA4IkBjB,GA5IlB,mBA6I8B,MAApBiB,EAASuf,OA7InB,yCA8IevgB,EAAI,IAAIb,IA9IvB,aAgJc,IAAIK,MAAM,yCAhJxB,wBAoJ0BwB,EAASC,OApJnC,eAoJUwG,EApJV,yBAsJW1H,EAAG0H,IAtJd,+GChBe,GACG,CACdG,QAAS,gBCYE,SAAS+Y,GAAqB7Y,GAC3C,IAAM8Y,EAAYC,eADgC,EAGpB7D,mBAAS,MAHW,mBAG3CzW,EAH2C,KAGlCua,EAHkC,KAI5CC,EAAcC,eACdC,EAAkBC,eAyBxB,OAvBA/Z,qBAAU,WACR,KACGyZ,EAAUO,WAAaP,EAAU/Z,UACjCoa,IACAA,EAAgBG,kBAHnB,CAOA,IAAMC,EAAiBT,EAAUO,UAC7B,kB,4CAAMG,CAAmCV,EAAUW,OADhC,sBAEnB,sBAAAlhB,EAAA,+EACE,IAAIyf,GACFiB,EAAYS,sBAAsBC,KAAKV,GACvCW,GAAsB9Z,UAH1B,4CAMM,uCAAG,4BAAAvH,EAAA,sEACKghB,IADL,OACLM,EADK,OAEXb,EAAWa,GAFA,2CAAH,qDAIVC,MACC,CAAChB,EAAUO,UAAWP,EAAU/Z,QAASka,IAExCE,IAAoBA,EAAgBG,kBAC/B,kBAAClD,GAAD,MAGF,kBAAC,GAAD,eAAkB3X,QAASA,GAAauB,I,8CAGjD,WAAkDyZ,GAAlD,eAAAlhB,EAAA,6DACQwhB,EACJN,EAAKO,MAAQP,EAAKO,KAAK9f,MAAK,kBAAqB,oBAArB,EAAG+f,OAFnC,kBAIS9hB,EAA4B4hB,GAAkBA,EAAe7X,KAJtE,4C","file":"static/js/4.ef7bd5e1.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/optic-contract-testing-diagram.9124d728.svg\";","export interface ITestingService {\n  loadSpecEvents(captureId: CaptureId): Promise<Result<RfcEventStream>>;\n\n  listCaptures(): Promise<Result<Capture[]>>;\n\n  loadCapture(captureId: CaptureId): Promise<Result<Capture, NotFoundError>>;\n\n  loadReport(\n    captureId: CaptureId\n  ): Promise<Result<CoverageReport, NotFoundError>>;\n\n  loadEndpointDiffs?(\n    captureId: CaptureId,\n    pathId: PathId,\n    httpMethod: HttpMethod\n  ): Promise<Result<any, NotFoundError>>;\n\n  loadUndocumentedEndpoints(\n    captureId: CaptureId\n  ): Promise<Result<UndocumentedEndpoint[], NotFoundError>>;\n}\n\nexport type CaptureId = string;\nexport type ISO8601Date = string;\nexport type StableHash = string;\nexport type PathId = string;\nexport type HttpMethod =\n  | 'GET'\n  | 'OPTIONS'\n  | 'DELETE'\n  | 'HEAD'\n  | 'PATCH'\n  | 'POST'\n  | 'PUT'\n  | 'TRACE';\n\nexport interface Capture {\n  captureId: CaptureId;\n  createdAt: ISO8601Date;\n  updatedAt: ISO8601Date;\n  completedAt: ISO8601Date | null;\n  tags: Array<{ name: string; value: string }>;\n}\n\nexport interface CoverageReport {\n  coverageCounts: {\n    // index signature parameter cannot be a type alias :(\n    [stableHash: string]: number;\n  };\n  diffs: {\n    // index signature parameter cannot be a type alias :(\n    [stableHash: string]: number;\n  };\n}\n\nexport interface UndocumentedEndpoint {\n  method: HttpMethod;\n  path: string;\n  pathId: PathId;\n  count: number;\n}\n\nexport interface RfcEvent {\n  // TODO create types for all types of events\n  [prop: string]: any;\n  eventContext: null | {\n    clientId: string;\n    clientSessionId: string;\n    clientCommandBatchId: string;\n    createdAt: ISO8601Date;\n  };\n}\n\nexport type RfcEventStream = Array<{ [eventType: string]: RfcEvent }>;\n\nconst TESTING_SERVICE_ERROR_TYPE = Symbol('testing-service-error');\nexport class TestingServiceError extends Error {\n  statusCode: number;\n  type: Symbol = TESTING_SERVICE_ERROR_TYPE;\n\n  static instanceOf(maybeErr) {\n    return maybeErr && maybeErr.type === TESTING_SERVICE_ERROR_TYPE;\n  }\n\n  notFound() {\n    return this.statusCode === 404;\n  }\n}\n\nexport class NotFoundError extends TestingServiceError {\n  statusCode = 404;\n}\n\ninterface IResult<T> {\n  isOk(): boolean;\n  isErr(): boolean;\n  unwrap(): T;\n}\n\nexport class Ok<T, E extends TestingServiceError = TestingServiceError>\n  implements IResult<T> {\n  constructor(readonly value: T) {}\n\n  isOk(): this is Ok<T, E> {\n    return true;\n  }\n\n  isErr(): this is Err<T, E> {\n    return !this.isOk();\n  }\n\n  unwrap(): T {\n    return this.value;\n  }\n\n  unwrapErr(): E {\n    throw new Error('Cannot unwrap error on Ok');\n  }\n}\n\nexport class Err<T, E extends TestingServiceError = TestingServiceError>\n  implements IResult<T> {\n  constructor(readonly error: E) {}\n\n  isOk(): this is Ok<T, E> {\n    return !this.isErr();\n  }\n\n  isErr(): this is Err<T, E> {\n    return true;\n  }\n\n  unwrap(): T {\n    throw this.error;\n  }\n\n  unwrapErr(): E {\n    return this.error;\n  }\n}\n\nexport type Result<T, E extends TestingServiceError = TestingServiceError> =\n  | Ok<T, E>\n  | Err<T, E>;\n\nexport function ok<T, E extends TestingServiceError = TestingServiceError>(\n  value: T\n): Ok<T, E> {\n  return new Ok(value);\n}\n\nexport function err<T, E extends TestingServiceError>(err: E): Err<T, E> {\n  return new Err(err);\n}\n","// TODO: Consider using a TypeScript interface here\n// interace ITestingService\nimport { opticEngine, Queries } from '@useoptic/domain';\n// placeholder for actual remote service\nimport { StableHasher } from '../../utilities/CoverageUtilities';\nimport { DiffManagerFacade, JsonHelper, mapScala } from '@useoptic/domain';\nimport {\n  ITestingService,\n  Result,\n  RfcEventStream,\n  Capture,\n  CoverageReport,\n  ok,\n  err,\n  NotFoundError,\n  UndocumentedEndpoint,\n} from '.';\n\nexport async function createExampleTestingService(exampleId = 'todo-report') {\n  const example = await fetch(`/example-reports/${exampleId}.json`, {\n    headers: {\n      accept: 'application/json',\n    },\n  }).then((response) => {\n    if (response.ok) {\n      return response.json();\n    }\n    throw new Error();\n  });\n\n  const { orgId, specs, samples: samplesByCaptureId, captures } = example;\n\n  function getSpecEvents(captureId) {\n    const spec = specs[captureId];\n    if (typeof spec === 'string') {\n      // allow specs for one capture reference other specs, to keep example json\n      // under control\n      return getSpecEvents(spec);\n    } else {\n      return spec;\n    }\n  }\n\n  function getSamples(captureId) {\n    const samples = samplesByCaptureId[captureId];\n    if (typeof samples === 'string') {\n      // allow samples for one capture reference other samples, to keep example json\n      // under control\n      return getSamples(samples);\n    } else {\n      return samples;\n    }\n  }\n\n  function notFoundErr() {\n    return new NotFoundError();\n  }\n\n  class ExampleTestingService implements ITestingService {\n    orgId: string;\n\n    constructor(orgId) {\n      this.orgId = orgId;\n    }\n\n    async loadSpecEvents(\n      captureId\n    ): Promise<Result<RfcEventStream, NotFoundError>> {\n      await new Promise((r) => setTimeout(r, 200));\n\n      const spec = getSpecEvents(captureId);\n\n      if (!spec) return err(notFoundErr());\n\n      return ok(spec);\n    }\n\n    async listCaptures(): Promise<Result<Capture[]>> {\n      await new Promise((r) => setTimeout(r, 400));\n\n      return ok(\n        captures.map(\n          // tolerate example resource evolving by only picking fields we need\n          ({ captureId, createdAt, updatedAt, completedAt, tags }) => {\n            return {\n              captureId,\n              createdAt,\n              updatedAt,\n              completedAt,\n              tags: tags.map(({ name, value }) => ({\n                name,\n                value,\n              })),\n            };\n          }\n        )\n      );\n    }\n\n    async loadCapture(captureId): Promise<Result<Capture, NotFoundError>> {\n      await new Promise((r) => setTimeout(r, 200));\n      const capture = captures.find(\n        (capture) => captureId === capture.captureId\n      );\n      if (!capture) return err(notFoundErr());\n\n      return ok(capture as Capture);\n    }\n\n    async loadReport(\n      captureId\n    ): Promise<Result<CoverageReport, NotFoundError>> {\n      await new Promise((r) => setTimeout(r, 2000));\n      const events = getSpecEvents(captureId);\n      const samples = getSamples(captureId);\n\n      if (!events || !samples) return err(notFoundErr());\n\n      const { rfcState, queries } = queriesFromEvents(events);\n      const shapesResolvers = queries.shapesResolvers();\n\n      const samplesSeq = JsonHelper.jsArrayToSeq(\n        samples.map((x) => JsonHelper.fromInteraction(x))\n      );\n      const converter = new opticEngine.com.useoptic.CoverageReportConverter(\n        StableHasher\n      );\n      const report = opticEngine.com.useoptic.diff.helpers\n        .CoverageHelpers()\n        .getCoverage(shapesResolvers, rfcState, samplesSeq);\n      try {\n        const asJs = opticEngine.CoverageReportJsonSerializer.toJs(report);\n        console.log({ asJs });\n        const fromJs = opticEngine.CoverageReportJsonDeserializer.fromJs(asJs);\n        console.log({ fromJs });\n      } catch (e) {\n        debugger;\n      }\n\n      const serializedReport = converter.toJs(report);\n      return ok(serializedReport);\n    }\n\n    async loadEndpointDiffs(\n      captureId,\n      pathId,\n      httpMethod\n    ): Promise<Result<any, NotFoundError>> {\n      const events = getSpecEvents(captureId);\n      const samples = getSamples(captureId);\n\n      if (!events || !samples) return err(notFoundErr());\n\n      const { rfcState, queries } = queriesFromEvents(events);\n      const shapesResolvers = queries.shapesResolvers();\n\n      const interactions = JsonHelper.jsArrayToSeq(\n        samples.map((sample) => JsonHelper.fromInteraction(sample))\n      );\n\n      const diffManager = DiffManagerFacade.newFromInteractions(\n        samples,\n        () => {}\n      );\n      diffManager.updatedRfcState(rfcState, shapesResolvers);\n      const endpointDiffManager = diffManager.managerForPathAndMethod(\n        pathId,\n        httpMethod,\n        JsonHelper.jsArrayToSeq([])\n      );\n\n      const regions = endpointDiffManager.diffRegions;\n\n      // TODO: replace this what the service will _actually_ be returning. Obviously,\n      // this isn't serialised as JSON fully, and I imagine there's other details not\n      // not considered.\n      return ok({\n        newRegions: JsonHelper.seqToJsArray(regions.newRegions),\n        bodyDiffs: JsonHelper.seqToJsArray(regions.bodyDiffs),\n      });\n    }\n\n    async loadUndocumentedEndpoints(\n      captureId\n    ): Promise<Result<UndocumentedEndpoint[], NotFoundError>> {\n      await new Promise((r) => setTimeout(r, 200));\n      const events = getSpecEvents(captureId);\n      const samples = getSamples(captureId);\n\n      if (!events || !samples) return err(notFoundErr());\n\n      const { rfcState, queries } = queriesFromEvents(events);\n      const shapesResolvers = queries.shapesResolvers();\n\n      const diffManager = DiffManagerFacade.newFromInteractions(\n        samples,\n        () => {}\n      );\n      diffManager.updatedRfcState(rfcState, shapesResolvers);\n\n      const undocumentedUrlsSeq = diffManager.unmatchedUrls(true);\n\n      return ok(\n        JsonHelper.seqToJsArray(undocumentedUrlsSeq).map(\n          ({ method, path, pathId, count }) => {\n            return {\n              method,\n              path,\n              pathId,\n              count,\n            };\n          }\n        )\n      );\n    }\n  }\n\n  return new ExampleTestingService(orgId);\n}\n\n// Might belong in a (View)Model somewhere\nexport function queriesFromEvents(events) {\n  const { contexts } = opticEngine.com.useoptic;\n  const { RfcServiceJSFacade } = contexts.rfc;\n  const rfcServiceFacade = RfcServiceJSFacade();\n  const eventStore = rfcServiceFacade.makeEventStore();\n  const rfcId = 'testRfcId';\n\n  const eventsForScala = opticEngine.EventSerialization.fromJs(events);\n  eventStore.append(rfcId, eventsForScala);\n  const rfcService = rfcServiceFacade.makeRfcService(eventStore);\n  const queries = Queries(eventStore, rfcService, rfcId);\n  const rfcState = rfcService.currentState(rfcId);\n\n  return { queries, rfcState };\n}\n","import React, {\n  useContext,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from 'react';\nimport { TestingServiceError } from '../services/testing';\n\nconst TestingDashboardContext = React.createContext(null);\n\n// only expose the Provider component, but hide the Consumer in favour of hooks\nexport const { Provider } = TestingDashboardContext;\n\n// to make sure the actual shape of the context remains an implementation detail\n// we're in control of here\nexport function createContext({ service, baseUrl }) {\n  return { service, baseUrl };\n}\n\nexport function useTestingService(\n  performRequest, // Note: this is where a TS interface would give some nice safety\n  deps = []\n) {\n  const { service } = useContext(TestingDashboardContext);\n\n  const versionRef = useRef(1);\n  const [state, dispatch] = useReducer(\n    serviceStateReducer,\n    initialServiceState(versionRef.current)\n  );\n\n  const isUnmounted = useRef(false);\n\n  useEffect(() => {\n    const effectVersion = versionRef.current;\n\n    function effectDispatch(action) {\n      return dispatch({\n        ...action,\n        version: effectVersion,\n        latestVersion: versionRef.current,\n      });\n    }\n\n    effectDispatch({ type: 'request' });\n    performRequest(service).then((result) => {\n      if (isUnmounted.current) return;\n      if (result.isOk()) {\n        effectDispatch({ type: 'receive_success', payload: result.value });\n      } else {\n        let err = result.unwrapErr();\n        if (err.notFound()) {\n          effectDispatch({ type: 'receive_not_found' });\n        } else {\n          effectDispatch({ type: 'receive_error', payload: err });\n        }\n      }\n    });\n\n    return () => {\n      versionRef.current++;\n    };\n  }, deps);\n\n  useEffect(() => {\n    return () => {\n      isUnmounted.current = true;\n    };\n  }, []);\n\n  return state;\n}\n\nexport function useReportPath(captureId) {\n  const { baseUrl } = useContext(TestingDashboardContext);\n\n  return `${baseUrl}/captures/${captureId}`;\n}\n\nexport function useEndpointPath(captureId, endpointId) {\n  const { baseUrl } = useContext(TestingDashboardContext);\n\n  return `${baseUrl}/captures/${captureId}/endpoints/${endpointId}`;\n}\n\nexport { queriesFromEvents } from '../services/testing/ExampleTestingService';\n\n// Reducers\n// --------\n\nfunction initialServiceState() {\n  return {\n    loading: false,\n    result: null,\n    error: null,\n    notFound: false,\n  };\n}\n\nfunction serviceStateReducer(state, action) {\n  if (action.version !== action.latestVersion) {\n    return state;\n  }\n\n  switch (action.type) {\n    case 'request': {\n      return {\n        ...initialServiceState(),\n        loading: true,\n      };\n    }\n    case 'receive_success': {\n      if (!state.loading) return state;\n\n      return {\n        ...state,\n        result: action.payload,\n        loading: false,\n      };\n    }\n    case 'receive_not_found': {\n      if (!state.loading) return state;\n\n      return {\n        ...state,\n        loading: false,\n        result: null,\n        notFound: true,\n      };\n    }\n    case 'receive_error': {\n      if (!state.loading) return state;\n\n      return {\n        ...state,\n        loading: false,\n        result: null,\n        error: action.payload,\n      };\n    }\n    default:\n      throw new Error(\n        `Unknown action type '${action.type}' for service state reducer`\n      );\n  }\n}\n","import React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport {\n  useEndpointPath,\n  useReportPath\n} from '../../contexts/TestingDashboardContext';\n\nexport default function ReportLink(props) {\n  const { captureId, ...otherProps } = props;\n  const path = useReportPath(captureId);\n\n  return <NavLink {...otherProps} to={path} />;\n}\n\nexport function ReportEndpointLink(props) {\n  const { captureId, endpointId, ...otherProps } = props;\n  const path = useEndpointPath(captureId, endpointId);\n\n  return <NavLink {...otherProps} to={path} />;\n}\n","import React, { useEffect, useMemo, useRef } from 'react';\nimport { useTestingService } from '../../contexts/TestingDashboardContext';\nimport { getOrUndefined, getIndex, JsonHelper } from '@useoptic/domain';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Color from 'color';\nimport ClassNames from 'classnames';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport WarningIcon from '@material-ui/icons/Warning';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nexport default function EndpointReportContainer(props) {\n  const { captureId, endpoint } = props;\n  const { error, loading, result: diffRegions } = useTestingService((service) =>\n    service.loadEndpointDiffs(captureId, endpoint.pathId, endpoint.method)\n  );\n\n  const diffsSummary = useMemo(() => {\n    if (!diffRegions) return null;\n    return createEndpointsDiffSummary(diffRegions);\n  });\n\n  if (error) throw error;\n\n  return (\n    <EndpointReport\n      endpointCounts={endpoint.counts}\n      endpointPurpose={endpoint.descriptor.endpointPurpose}\n      loadingDiffsSummary={loading}\n      diffsSummary={diffsSummary}\n    />\n  );\n}\n\nexport function EndpointReport(props) {\n  const { diffsSummary, endpointPurpose, endpointCounts } = props;\n\n  const classes = useStyles();\n  const containerRef = useScrollToCurrent(true);\n\n  return (\n    <div ref={containerRef} className={classes.root}>\n      <h6 className={classes.endpointPurpose}>{endpointPurpose}</h6>\n\n      {diffsSummary && <EndpointDiffsSummary diffsSummary={diffsSummary} />}\n    </div>\n  );\n}\n\nfunction EndpointDiffsSummary({ diffsSummary }) {\n  const { responses, requests } = diffsSummary;\n  const classes = useStyles();\n\n  if (diffsSummary.totalCount < 1) {\n    return <div>No diffs!</div>;\n  } else {\n    return (\n      <div className={classes.diffsContainer}>\n        {requests.count > 0 && (\n          <div className={ClassNames(classes.diffs, classes.requestDiffs)}>\n            <h4 className={classes.diffsLocationHeader}>Requests</h4>\n\n            <>\n              {requests.regionDiffs.length > 0 && (\n                <ul className={classes.diffsList}>\n                  {requests.regionDiffs.map((diff) => (\n                    <li key={diff.id} className={classes.diffsListItem}>\n                      <NewRegionDiffDescription\n                        contentType={diff.contentType}\n                        statusCode={diff.statusCode}\n                        count={diff.count}\n                        inResponse={true}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              )}\n\n              {requests.bodyDiffs.length > 0 && (\n                <ul className={classes.diffsList}>\n                  {requests.bodyDiffs.map((diff) => (\n                    <li key={diff.id} className={classes.diffsListItem}>\n                      <BodyDiffDescription\n                        assertion={diff.assertion}\n                        changeType={diff.changeType}\n                        count={diff.count}\n                        contentType={diff.contentType}\n                        path={diff.path}\n                        inRequest={true}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </>\n          </div>\n        )}\n\n        {responses.count > 0 && (\n          <div className={ClassNames(classes.diffs, classes.responseDiffs)}>\n            <h4 className={classes.diffsLocationHeader}>Responses</h4>\n            <>\n              {responses.regionDiffs.length > 0 && (\n                <ul className={classes.diffsList}>\n                  {responses.regionDiffs.map((diff) => (\n                    <li key={diff.id} className={classes.diffsListItem}>\n                      <NewRegionDiffDescription\n                        contentType={diff.contentType}\n                        statusCode={diff.statusCode}\n                        count={diff.count}\n                        inResponse={true}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              )}\n\n              {responses.bodyDiffs.length > 0 && (\n                <ul className={classes.diffsList}>\n                  {responses.bodyDiffs.map((diff) => (\n                    <li key={diff.id} className={classes.diffsListItem}>\n                      <BodyDiffDescription\n                        assertion={diff.assertion}\n                        changeType={diff.changeType}\n                        count={diff.count}\n                        contentType={diff.contentType}\n                        path={diff.path}\n                        statusCode={diff.statusCode}\n                        inResponse={true}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nfunction NewRegionDiffDescription({\n  contentType,\n  count,\n  statusCode,\n  inRequest,\n  inResponse,\n}) {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.diffContainer}>\n      <div className={classes.diffDescription}>\n        {inRequest && (\n          <>\n            Undocumented Request type (<code>{contentType}</code>)\n          </>\n        )}\n\n        {inResponse && (\n          <>\n            Undocumented <code>{statusCode}</code> Response type (\n            <code>{contentType}</code>)\n          </>\n        )}\n      </div>\n      <small className={classes.diffMeta}>\n        {inResponse\n          ? 'new combination of status code and content type'\n          : 'new content type'}{' '}\n        observed <strong>{count > 1 ? `${count} times` : 'once'}</strong>\n      </small>\n    </div>\n  );\n}\n\nfunction BodyDiffDescription({\n  assertion,\n  changeType,\n  contentType,\n  count,\n  inRequest,\n  inResponse,\n  path,\n  statusCode,\n}) {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.diffContainer}>\n      <div className={classes.diffDescription}>\n        {inRequest && (\n          <>\n            Shape mismatch in Request body (<code>{contentType}</code>)\n          </>\n        )}\n\n        {inResponse && (\n          <>\n            Shape mismatch in <code>{statusCode}</code> Response body (\n            <code>{contentType}</code>):\n          </>\n        )}\n      </div>\n\n      <small className={classes.diffMeta}>\n        difference with documentated shape observed{' '}\n        <strong>{count > 1 ? `${count} times` : 'once'}</strong>\n      </small>\n\n      <div className={classes.diffFieldTrail}>\n        <div className={classes.diffFieldTrailRoot}>\n          <code>\n            {statusCode} {inResponse ? 'Response' : 'Request'} Body\n          </code>\n        </div>\n\n        <ul className={classes.diffFieldTrailComponents}>\n          {path.map((pathComponent, i, components) => (\n            <li className={classes.diffFieldTrailComponent} key={pathComponent}>\n              <ChevronRightIcon className={classes.diffFieldTrailSeparator} />\n              <code>{pathComponent}</code>\n\n              {i === components.length - 1 && (\n                <div className={classes.diffFieldTrailAssertion}>\n                  <WarningIcon className={classes.diffFielTrailWarningIcon} />\n                  {assertion}\n                </div>\n              )}\n            </li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  );\n}\n\nfunction useScrollToCurrent(isCurrent) {\n  const containerRef = useRef();\n  useEffect(() => {\n    if (!isCurrent) return;\n\n    if (!containerRef.current)\n      throw Error(\n        'Ref must be set to DOM node in order to scroll it into view upon activation'\n      );\n\n    scrollIntoView(containerRef.current, {\n      scrollMode: 'if-needed',\n      block: 'center',\n    });\n  }, [isCurrent]);\n\n  return containerRef;\n}\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    padding: theme.spacing(0, 2),\n  },\n\n  endpointPurpose: {\n    ...theme.typography.h6,\n    margin: 0,\n  },\n\n  diffsContainer: {},\n\n  diffs: {\n    marginBottom: theme.spacing(4),\n  },\n\n  diffsLocationHeader: {\n    ...theme.typography.overline,\n    margin: theme.spacing(2, 0, 3),\n    color: Color(theme.palette.primary.main)\n      .desaturate(0.55)\n      .lighten(1.2)\n      .hex(),\n    borderBottom: `1px solid ${Color(theme.palette.primary.main)\n      .desaturate(0.55)\n      .lighten(1.9)\n      .hex()}`,\n  },\n\n  diffsList: {\n    padding: 0,\n    listStyleType: 'none',\n  },\n\n  diffsListItem: {\n    marginBottom: theme.spacing(4),\n  },\n\n  diffDescription: {\n    fontSize: theme.typography.pxToRem(theme.typography.fontSize + 1),\n\n    '& code': {\n      color: theme.palette.primary.main,\n    },\n  },\n\n  diffMeta: {\n    ...theme.typography.subtitle2,\n    color: theme.palette.grey[600],\n    fontWeight: theme.typography.fontWeightLight,\n    fontSize: theme.typography.pxToRem(12),\n  },\n\n  diffFieldTrail: {\n    padding: theme.spacing(1.5, 2, 0, 1.5),\n    marginLeft: 2,\n    borderLeft: `8px solid ${theme.palette.grey[50]}`,\n    display: 'flex',\n    alignItems: 'flex-start',\n    alignContent: 'baseline',\n    fontSize: theme.typography.pxToRem(theme.typography.fontSize - 1),\n  },\n\n  diffFieldTrailRoot: {\n    display: 'flex',\n    flexGrow: 0,\n    flexShrink: 0,\n\n    alignItems: 'center',\n\n    '& code': {\n      padding: theme.spacing(0.5, 1),\n      color: theme.palette.primary.light,\n      background: theme.palette.grey[100],\n    },\n  },\n\n  diffFieldTrailComponents: {\n    display: 'flex',\n    alignItems: 'center',\n    padding: 0,\n    flexWrap: 'wrap',\n\n    listStyleType: 'none',\n  },\n\n  diffFieldTrailComponent: {\n    display: 'flex',\n    flexGrow: 0,\n    flexShrink: 0,\n    marginBottom: theme.spacing(1),\n\n    alignItems: 'center',\n\n    '& code': {\n      padding: theme.spacing(0.5, 1),\n      color: theme.palette.primary.light,\n      background: theme.palette.grey[100],\n    },\n\n    '&:last-child code': {\n      background: Color(theme.palette.error.light).lighten(0.3).hex(),\n      color: Color(theme.palette.error.dark).darken(0.5).hex(),\n    },\n  },\n\n  diffFieldTrailAssertion: {\n    display: 'flex',\n    alignItems: 'center',\n    padding: theme.spacing(0.5, 1),\n\n    color: Color(theme.palette.error.dark).darken(0.2).hex(),\n  },\n\n  diffFielTrailWarningIcon: {\n    width: 20,\n    height: 20,\n    marginRight: theme.spacing(1),\n    color: Color(theme.palette.removed.main).darken(0.3).hex(),\n  },\n\n  diffFieldTrailSeparator: {\n    width: theme.typography.pxToRem(theme.typography.fontSize + 2),\n    color: theme.palette.grey[400],\n  },\n}));\n\nfunction createEndpointsDiffSummary(diffRegions) {\n  const { bodyDiffs, newRegions } = diffRegions;\n\n  const responseNewRegions = newRegions.filter(getInResponse);\n  const responseBodyDiffs = bodyDiffs.filter(getInResponse);\n  const requestNewRegions = newRegions.filter(getInRequest);\n  const requestBodyDiffs = bodyDiffs.filter(getInRequest);\n\n  const requests = {\n    regionDiffs: requestNewRegions.map(createRegionDiff),\n    bodyDiffs: requestBodyDiffs.map(createShapeDiff),\n    unmatchedContentTypes: requestNewRegions\n      .filter(getContentType)\n      .map(getContentType),\n  };\n\n  const responses = {\n    regionDiffs: responseNewRegions.map(createRegionDiff),\n    bodyDiffs: responseBodyDiffs.map(createShapeDiff),\n    unmatchedStatusCodes: responseNewRegions\n      .filter(getStatusCode)\n      .map(getStatusCode),\n    unmatchedContentTypes: responseNewRegions\n      .filter(getContentType)\n      .map(getContentType),\n  };\n\n  return {\n    totalCount: bodyDiffs.length + newRegions.length,\n    responses: {\n      ...responses,\n      count: responses.regionDiffs.length + responses.bodyDiffs.length,\n    },\n    requests: {\n      ...requests,\n      count: requests.regionDiffs.length + requests.bodyDiffs.length,\n    },\n  };\n\n  function getInRequest(diff) {\n    return diff.inRequest;\n  }\n  function getInResponse(diff) {\n    return diff.inResponse;\n  }\n  function getStatusCode(diff) {\n    return diff.statusCode;\n  }\n  function getContentType(diff) {\n    return diff.contentType;\n  }\n  function createShapeDiff(diff) {\n    const interaction = getIndex(diff.interactions)(0);\n    const body = diff.inRequest\n      ? interaction.request.body\n      : interaction.response.body;\n\n    return {\n      id: diff.toString(),\n      assertion: diff.description.assertion,\n      contentType: getOrUndefined(body.contentType),\n      count: 1, // replace with actual count\n      changeType: diff.description.changeTypeAsString,\n      path: JsonHelper.seqToJsArray(diff.description.path),\n      summary: diff.description.summary,\n      statusCode: diff.inResponse ? interaction.response.statusCode : null,\n    };\n  }\n\n  function createRegionDiff(diff) {\n    return {\n      id: diff.toString(),\n      count: 1, // replace with actual count\n      contentType: getOrUndefined(diff.contentType),\n      statusCode: getOrUndefined(diff.statusCode),\n      changeType: diff.description.changeTypeAsString,\n      summary: diff.description.summary || diff.description.assertion,\n    };\n  }\n}\n","import React, { useCallback, useMemo } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { opticEngine } from '@useoptic/domain';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport classNames from 'classnames';\nimport Color from 'color';\nimport dateFormatRelative from 'date-fns/formatRelative';\nimport dateFormatDistance from 'date-fns/formatDistance';\nimport { parseISO as dateParseISO } from 'date-fns';\nimport { usePageTitle } from '../Page';\nimport { useReportPath } from '../../contexts/TestingDashboardContext';\nimport _sortBy from 'lodash.sortby';\n\nimport {\n  createEndpointDescriptor,\n  getEndpointId,\n} from '../../utilities/EndpointUtilities';\nimport { StableHasher } from '../../utilities/CoverageUtilities';\n\nimport ScheduleIcon from '@material-ui/icons/Schedule';\nimport FiberManualRecordIcon from '@material-ui/icons/FiberManualRecord';\nimport { Card } from '@material-ui/core';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport { ReportEndpointLink } from './report-link';\nimport EndpointReport from './EndpointReport';\n\nexport default function ReportSummary(props) {\n  const { capture, report, spec, currentEndpointId } = props;\n  const classes = useStyles();\n  const classesHttpMethods = useHttpMethodStyles();\n  const { captureId } = capture;\n  const reportPath = useReportPath(captureId);\n\n  const summary = useMemo(() => createSummary(capture, spec, report), [\n    capture,\n    spec,\n    report,\n  ]);\n\n  // closing endpoint upon clicking report outside list\n  const history = useHistory();\n  const onClickList = useCallback((e) => {\n    // clicks inside list don't close the current endpoint\n    e.stopPropagation();\n  });\n  const onClickContainer = useCallback((e) => {\n    history.replace(reportPath);\n  });\n\n  const undocumentedEndpoints = useMemo(\n    () =>\n      _sortBy(\n        props.undocumentedEndpoints,\n        (undocumented) => -undocumented.count,\n        (undocumented) => undocumented.path,\n        (undocumented) => undocumented.method\n      ),\n    [props.undocumentedEndpoints]\n  );\n\n  const {\n    endpoints,\n    isCapturing,\n    totalInteractions,\n    totalCompliantInteractions,\n    totalDiffs,\n    totalUnmatchedPaths,\n  } = summary;\n\n  const now = new Date();\n\n  usePageTitle(\n    summary.buildId && summary.environment\n      ? `Report for '${summary.buildId}' in '${summary.environment}'`\n      : 'Report'\n  );\n\n  return (\n    <div className={classes.root} onClick={onClickContainer}>\n      <div className={classes.reportMeta}>\n        <div className={classes.captureTime}>\n          {summary.isCapturing ? (\n            <div className={classes.liveIndicator}>\n              <FiberManualRecordIcon className={classes.recordIcon} />\n              <span className={classes.liveLabel}>LIVE</span>\n            </div>\n          ) : (\n            <ScheduleIcon className={classes.historyIcon} />\n          )}\n          {summary.isCapturing ? (\n            <>since {dateFormatRelative(summary.createdAt, now)}</>\n          ) : (\n            <>\n              ended {dateFormatRelative(summary.completedAt, now)} after{' '}\n              {dateFormatDistance(summary.completedAt, summary.createdAt)}\n            </>\n          )}\n        </div>\n      </div>\n\n      <div className={classes.stats}>\n        <SummaryStats\n          totalInteractions={totalInteractions}\n          totalDiffs={totalDiffs}\n          totalUnmatchedPaths={totalUnmatchedPaths}\n          totalUndocumentedEndpoints={undocumentedEndpoints.length}\n        />\n        <h4 className={classes.buildName}>\n          from capturing interactions for build <code>{summary.buildId}</code>{' '}\n          in <code>{summary.environment}</code>\n        </h4>\n      </div>\n\n      <h4 className={classes.endpointsHeader}>Endpoints</h4>\n\n      {endpoints.length > 0 ? (\n        <ul className={classes.endpointsList} onClick={onClickList}>\n          {endpoints.map((endpoint) => {\n            const endpointHeader = (\n              <div className={classes.endpointHeader}>\n                <span\n                  className={classNames(\n                    classes.endpointMethod,\n                    classesHttpMethods[endpoint.descriptor.httpMethod]\n                  )}\n                >\n                  {endpoint.descriptor.httpMethod}\n                </span>\n                <code className={classes.endpointPath}>\n                  {endpoint.descriptor.fullPath}\n                </code>\n\n                <div className={classes.endpointStats}>\n                  {endpoint.counts.diffs > 0 &&\n                    process.env\n                      .REACT_APP_TESTING_DASHBOARD_ENDPOINT_DIFF_STATS ===\n                      'true' && (\n                      <span\n                        className={classNames(\n                          classes.endpointChip,\n                          classes.endpointDiffsChip\n                        )}\n                      >\n                        <strong>{endpoint.counts.diffs}</strong>\n                        {endpoint.counts.diffs > 1 ? ' diffs' : ' diff'}\n                      </span>\n                    )}\n                  {endpoint.counts.incompliant > 0 ? (\n                    <span\n                      className={classNames(\n                        classes.endpointChip,\n                        classes.endpointIncompliantChip\n                      )}\n                    >\n                      <strong>\n                        {endpoint.counts.incompliant}/\n                        {endpoint.counts.interactions}\n                      </strong>\n                      {' incompliant'}\n                    </span>\n                  ) : (\n                    <span\n                      className={classNames(\n                        classes.endpointChip,\n                        classes.endpointCompliantChip\n                      )}\n                    >\n                      <strong>\n                        {endpoint.counts.compliant}/\n                        {endpoint.counts.interactions}\n                      </strong>\n                      {' compliant'}\n                    </span>\n                  )}\n                </div>\n              </div>\n            );\n            return (\n              <li\n                key={endpoint.id}\n                className={classNames(classes.endpointsListItem, {\n                  [classes.isCurrent]:\n                    currentEndpointId && endpoint.id === currentEndpointId,\n                })}\n              >\n                <Card className={classes.endpointCard}>\n                  {process.env.REACT_APP_TESTING_DASHBOARD_ENDPOINT_DETAILS ===\n                  'true' ? (\n                    <ReportEndpointLink\n                      replace\n                      className={classes.endpointLink}\n                      captureId={captureId}\n                      endpointId={endpoint.id}\n                    >\n                      {endpointHeader}\n                    </ReportEndpointLink>\n                  ) : (\n                    <div className={classes.endpointLink}>{endpointHeader}</div>\n                  )}\n                  {currentEndpointId && endpoint.id === currentEndpointId && (\n                    <EndpointReport endpoint={endpoint} captureId={captureId} />\n                  )}\n                </Card>\n              </li>\n            );\n          })}\n        </ul>\n      ) : (\n        // @TODO: revisit this empty state\n        <p>No endpoints have been documented yet</p>\n      )}\n\n      {process.env.REACT_APP_TESTING_DASHBOARD_UNDOCUMENTED_ENDPOINTS ===\n        'true' && (\n        <>\n          <h4 className={classes.endpointsHeader}>Undocumented Endpoints</h4>\n\n          {undocumentedEndpoints.length > 0 && (\n            <ul className={classes.endpointsList}>\n              {undocumentedEndpoints.map((undocumented) => (\n                <li\n                  key={undocumented.method + undocumented.path}\n                  className={classNames(\n                    classes.endpointsListItem,\n                    classes.isUndocumented\n                  )}\n                >\n                  <Card className={classes.endpointCard}>\n                    <div className={classes.endpointHeader}>\n                      <span\n                        className={classNames(\n                          classes.endpointMethod,\n                          classesHttpMethods[undocumented.method]\n                        )}\n                      >\n                        {undocumented.method}\n                      </span>\n                      <code className={classes.endpointPath}>\n                        {undocumented.path}\n                      </code>\n\n                      <div className={classes.endpointStats}>\n                        <span\n                          className={classNames(\n                            classes.endpointChip,\n                            classes.endpointIncompliantChip\n                          )}\n                        >\n                          <strong>\n                            {undocumented.count}/{undocumented.count}\n                          </strong>\n                          {' incompliant'}\n                        </span>\n                      </div>\n                    </div>\n                  </Card>\n                </li>\n              ))}\n            </ul>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\nReportSummary.displayName = 'Testing/ReportSummary';\n\nfunction SummaryStats({\n  totalInteractions,\n  totalDiffs,\n  totalUnmatchedPaths,\n  totalUndocumentedEndpoints,\n}) {\n  const classes = useStyles();\n\n  const diffsStat =\n    process.env.REACT_APP_TESTING_DASHBOARD_ENDPOINT_DIFF_STATS === 'true' ? (\n      <>\n        yielding in <Stat value={totalDiffs} label=\"diff\" />\n      </>\n    ) : (\n      <>\n        of which{' '}\n        <Stat value={totalDiffs} label=\"incompliant\" pluralize={false} />\n      </>\n    );\n\n  const undocumentedStat =\n    process.env.REACT_APP_TESTING_DASHBOARD_UNDOCUMENTED_ENDPOINTS ===\n    'true' ? (\n      <Stat value={totalUndocumentedEndpoints} label=\"undocumented endpoint\" />\n    ) : (\n      <>\n        <Stat\n          value={totalUnmatchedPaths}\n          label=\"against\n        undocumented endpoints\"\n          pluralize={false}\n        />\n      </>\n    );\n\n  return (\n    <Typography variant=\"h6\" color=\"primary\" style={{ fontWeight: 200 }}>\n      Optic observed <Stat value={totalInteractions} label=\"interaction\" />,{' '}\n      {diffsStat} and {undocumentedStat}.\n    </Typography>\n  );\n}\nSummaryStats.displayName = 'Testing/ReportSummary/SummaryStats';\n\nfunction Stat({ value = 0, label = '', pluralize = true }) {\n  return (\n    <span>\n      {value !== 0 && (\n        <Typography\n          variant=\"h6\"\n          component=\"span\"\n          color=\"secondary\"\n          style={{ fontWeight: 800 }}\n        >\n          {value}{' '}\n        </Typography>\n      )}\n      <Typography variant=\"h6\" component=\"span\" style={{ fontWeight: 800 }}>\n        {value === 0 && 'no '}\n        {label}\n        {!pluralize || value === 1 ? '' : 's'}\n      </Typography>\n    </span>\n  );\n}\n\nexport function LoadingReportSummary() {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.reportMeta}>\n        <Skeleton width=\"20%\" height=\"1rem\" />\n      </div>\n\n      <div className={classes.stats}>\n        <Skeleton width=\"100%\" height=\"2.8rem\" />\n        <Skeleton width=\"30%\" height=\"2.8rem\" />\n        <h4 className={classes.buildName}>\n          <Skeleton width=\"60%\" height=\"1.5rem\" />\n        </h4>\n      </div>\n\n      <Skeleton width=\"85px\" height=\"1rem\" />\n\n      <ul className={classes.endpointsList}>\n        <li className={classes.endpointsListItem}>\n          <div className={classes.endpointHeader}>\n            <span className={classes.endpointMethod}>\n              <Skeleton width=\"40px\" height=\"2rem\" />\n            </span>\n            <span className={classes.endpointPath}>\n              <Skeleton width=\"70%\" height=\"2rem\" />\n            </span>\n\n            <div className={classes.endpointStats}>\n              <Skeleton width=\"45px\" height=\"2rem\" style={{ marginRight: 8 }} />\n              <Skeleton width=\"58px\" height=\"2rem\" />\n            </div>\n          </div>\n        </li>\n\n        <li className={classes.endpointsListItem}>\n          <div className={classes.endpointHeader}>\n            <span className={classes.endpointMethod}>\n              <Skeleton width=\"40px\" height=\"2rem\" />\n            </span>\n            <span className={classes.endpointPath}>\n              <Skeleton width=\"60%\" height=\"2rem\" />\n            </span>\n\n            <div className={classes.endpointStats}>\n              <Skeleton width=\"40px\" height=\"2rem\" style={{ marginRight: 8 }} />\n              <Skeleton width=\"50px\" height=\"2rem\" />\n            </div>\n          </div>\n        </li>\n\n        <li className={classes.endpointsListItem}>\n          <div className={classes.endpointHeader}>\n            <span className={classes.endpointMethod}>\n              <Skeleton width=\"40px\" height=\"2rem\" />\n            </span>\n            <span className={classes.endpointPath}>\n              <Skeleton width=\"60%\" height=\"2rem\" />\n            </span>\n\n            <div className={classes.endpointStats}>\n              <Skeleton width=\"40px\" height=\"2rem\" />\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n  );\n}\n\n// Styles\n// -------\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    padding: theme.spacing(3, 4),\n    maxWidth: theme.breakpoints.values.lg,\n    flexGrow: 1,\n  },\n\n  reportMeta: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    marginBottom: theme.spacing(3),\n  },\n\n  captureTime: {\n    display: 'flex',\n    alignItems: 'center',\n    color: theme.palette.grey[500],\n    fontSize: theme.typography.pxToRem(12),\n  },\n\n  buildName: {\n    ...theme.typography.subtitle2,\n    fontWeight: theme.typography.fontWeightLight,\n    margin: 0,\n    marginTop: theme.spacing(0.25),\n    color: theme.palette.primary.light,\n\n    '& code': {\n      color: theme.palette.primary.light,\n      fontWeight: 'bold',\n    },\n  },\n\n  stats: {\n    marginBottom: theme.spacing(6),\n  },\n\n  liveIndicator: {\n    display: 'flex',\n    alignItems: 'center',\n    marginRight: theme.spacing(0.5),\n  },\n\n  recordIcon: {\n    width: 16,\n    height: 16,\n    marginRight: theme.spacing(0.5),\n    fill: theme.palette.secondary.main,\n  },\n\n  liveLabel: {\n    ...theme.typography.caption,\n  },\n\n  historyIcon: {\n    width: 14,\n    height: 14,\n    marginRight: theme.spacing(0.5),\n  },\n\n  summaryStat: {},\n\n  endpointsHeader: {\n    ...theme.typography.overline,\n    color: '#818892',\n    borderBottom: `1px solid #e3e8ee`,\n  },\n\n  endpointsList: {\n    margin: theme.spacing(0, -2),\n    padding: 0,\n    listStyleType: 'none',\n  },\n\n  isUndocumented: {}, // for use below\n\n  endpointsListItem: {\n    '&$isUndocumented': {\n      padding: theme.spacing(1, 0),\n    },\n  },\n\n  endpointCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: 'rgba(255,255,255,0)',\n    boxShadow: 'none',\n\n    willChange: 'backgroundColor',\n    transition: '0.1s ease-out backgroundColor',\n\n    '$isCurrent &': {\n      margin: theme.spacing(1, 0),\n      boxShadow: theme.shadows[2],\n      backgroundColor: 'rgba(255,255,255,1)',\n    },\n  },\n\n  endpointLink: {\n    flexGrow: 1,\n    padding: theme.spacing(1, 0),\n    textDecoration: 'none',\n    color: 'inherit',\n\n    '&:hover': {\n      backgroundColor: theme.palette.grey[100],\n    },\n\n    '$isCurrent &': {\n      backgroundColor: 'transparent',\n      padding: 0,\n\n      '&:hover': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n\n  endpointHeader: {\n    display: 'grid',\n    gridTemplateColumns: 'max-content 1fr max-content',\n    gridColumnGap: theme.spacing(2),\n    alignItems: 'center',\n    padding: theme.spacing(0, 2),\n    // paddingTop: 0,\n    // paddingBottom: 0,\n\n    willChange: 'padding',\n    transition: '0.1s ease-out padding',\n\n    '$isCurrent &': {\n      padding: theme.spacing(2, 2),\n      // paddingTop: theme.spacing(2),\n      // paddingBottom: theme.spacing(2),\n    },\n  },\n\n  endpointMethod: {\n    padding: theme.spacing(0.5),\n    flexGrow: 0,\n    flexShrink: 0,\n    borderRadius: theme.shape.borderRadius,\n\n    fontWeight: theme.typography.fontWeightRegular,\n\n    '$isUndocumented &': {\n      opacity: 0.5,\n    },\n  },\n\n  endpointPath: {\n    fontSize: theme.typography.pxToRem(13),\n    color: theme.palette.primary.main,\n\n    '$isUndocumented &': {\n      opacity: 0.8,\n      fontStyle: 'italic',\n    },\n  },\n\n  endpointStats: {\n    display: 'flex',\n  },\n\n  endpointChip: {\n    flexGrow: 0,\n    flexShrink: 0,\n\n    height: theme.spacing(3),\n    padding: theme.spacing(0, 1),\n    marginRight: theme.spacing(1),\n\n    borderRadius: theme.spacing(3 / 2),\n    fontSize: theme.typography.pxToRem(11),\n    lineHeight: `${theme.spacing(3)}px`,\n\n    '& > strong': {\n      fontSize: theme.typography.pxToRem(13),\n    },\n\n    '$isUndocumented &': {\n      opacity: 0.6,\n    },\n  },\n\n  endpointDiffsChip: {\n    background: Color(theme.palette.error.light).lighten(0.3).hex(),\n\n    color: Color(theme.palette.error.dark).darken(0.5).hex(),\n  },\n\n  endpointIncompliantChip: {\n    background: Color(theme.palette.warning.light).lighten(0.3).hex(),\n    color: Color(theme.palette.warning.dark).darken(0.5).hex(),\n  },\n\n  endpointCompliantChip: {\n    background: Color(theme.palette.success.light).lighten(0.3).hex(),\n    color: Color(theme.palette.success.dark).darken(0.5).hex(),\n  },\n\n  // states\n  isCurrent: {},\n}));\n\n// TODO: Consider moving this to PathAndMethod or some other more general module, for consistency.\n// Take note that probably means allowing injecting base styles, as context dictates a lot of that.\nconst useHttpMethodStyles = makeStyles((theme) => {\n  const base = {\n    color: '#fff',\n  };\n\n  return ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'].reduce(\n    (styles, httpMethod) => {\n      const color = theme.palette.httpMethods[httpMethod];\n      styles[httpMethod] = {\n        ...base,\n        backgroundColor: color.dark,\n      };\n      return styles;\n    },\n    {}\n  );\n});\n\nconst CoverageConcerns = opticEngine.com.useoptic.coverage;\n\n// View models\n// -----------\n// TODO: consider moving these into their own modules or another appropriate spot (probably stable\n// for the entire dashboard context if not all of the app?)\n\nfunction createSummary(capture, spec, report) {\n  const { apiName, endpoints: specEndpoints } = spec;\n\n  const totalInteractions = getCoverageCount(\n    CoverageConcerns.TotalInteractions()\n  );\n  const totalUnmatchedPaths = getCoverageCount(\n    CoverageConcerns.TotalUnmatchedPath()\n  );\n\n  const endpoints = specEndpoints.map((endpoint, i) => {\n    const endpointDescriptor = createEndpointDescriptor(endpoint, spec);\n    const endpointId = getEndpointId(endpoint);\n\n    const { pathId, httpMethod } = endpointDescriptor;\n\n    const interactionsCounts = getCoverageCount(\n      CoverageConcerns.TotalForPathAndMethod(pathId, httpMethod)\n    );\n    const compliantCount = getCoverageCount(\n      CoverageConcerns.TotalForPathAndMethodWithoutDiffs(pathId, httpMethod)\n    );\n    const incompliantInteractions = interactionsCounts - compliantCount;\n    const diffsCount = incompliantInteractions * (i % 3 === 0 ? 1 : 2); // TODO: Hardcoded test value, replace by deriving from report,\n\n    return {\n      id: endpointId,\n      pathId: endpoint.pathId,\n      method: endpoint.method,\n      descriptor: endpointDescriptor,\n      counts: {\n        interactions: interactionsCounts,\n        diffs: diffsCount,\n        compliant: compliantCount,\n        incompliant: incompliantInteractions,\n      },\n    };\n  });\n\n  const totalDiffs = endpoints // TODO: Hardcoded test value, replace by deriving from report\n    .map((endpoint) => endpoint.counts.diffs)\n    .reduce((sum, num) => sum + num, 0);\n  const totalCompliantInteractions = totalInteractions - totalDiffs;\n\n  const buildIdTag = capture.tags.find(({ name }) => name === 'buildId');\n  const envTag = capture.tags.find(({ name }) => name === 'environmentName');\n\n  return {\n    apiName,\n    createdAt: asDate(capture.createdAt),\n    updatedAt: asDate(capture.updatedAt),\n    completedAt: asDate(capture.completedAt),\n    isCapturing: !capture.completedAt,\n    buildId: (buildIdTag && buildIdTag.value) || '',\n    environment: (envTag && envTag.value) || '',\n    endpoints: _sortBy(\n      endpoints,\n      (endpoint) => -endpoint.counts.incompliant,\n      (endpoint) => totalDiffs - endpoint.counts.diffs,\n      (endpoint) => endpoint.descriptor.fullPath,\n      (endpoint) => endpoint.method\n    ),\n    totalInteractions,\n    totalUnmatchedPaths,\n    totalDiffs,\n    totalCompliantInteractions,\n  };\n\n  function getCoverageCount(concern) {\n    const key = StableHasher.hash(concern);\n    return report.coverageCounts[key] || 0;\n  }\n\n  function asDate(isoDate) {\n    return isoDate && dateParseISO(isoDate);\n  }\n}\n","import React from 'react';\n\nexport default function (props) {\n  const { href, children, ...otherProps } = props;\n\n  return (\n    <a\n      href=\"https://calendly.com/opticlabs/optic-setup\"\n      target=\"_blank\"\n      {...otherProps}\n    >\n      {children}\n    </a>\n  );\n}\n","import React, { useEffect, useMemo, useRef } from 'react';\nimport { useTestingService } from '../../contexts/TestingDashboardContext';\nimport classNames from 'classnames';\nimport ReportLink from './report-link';\nimport dateParseISO from 'date-fns/parseISO';\nimport dateFormatRelative from 'date-fns/formatRelative';\nimport dateFormatDistance from 'date-fns/formatDistance';\nimport groupBy from 'lodash.groupby';\nimport scrollIntoView from 'scroll-into-view-if-needed';\nimport _sortBy from 'lodash.sortby';\n\n// Components\nimport { Card } from '@material-ui/core';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport ScheduleIcon from '@material-ui/icons/Schedule';\nimport FiberManualRecordIcon from '@material-ui/icons/FiberManualRecord';\nimport { makeStyles } from '@material-ui/core/styles';\n\nexport default function ReportsNavigation({\n  currentCaptureId,\n  onCapturesFetched,\n}) {\n  const classes = useStyles();\n  const { loading, error, result: captures } = useTestingService(\n    (service) => service.listCaptures(),\n    []\n  );\n\n  const capturesLists = useMemo(() => createCapturesLists(captures || []), [\n    captures,\n  ]);\n  const mockCaptureLists = useMemo(() => createMockCapturesLists(), []);\n\n  useEffect(() => {\n    if (loading || error) return;\n\n    onCapturesFetched([...capturesLists.active, ...capturesLists.completed]);\n  }, [loading, error, capturesLists]);\n\n  return (\n    <nav className={classes.navRoot}>\n      {(loading || capturesLists.active.length > 0) && (\n        <div className={classes.activeCaptures}>\n          {loading ? (\n            <ul className={classes.capturesList}>\n              {mockCaptureLists.active.map((n) => (\n                <li key={n} className={classes.captureListItem}>\n                  <MockActiveCapture n={n} />\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <ul className={classes.capturesList}>\n              {capturesLists.active.map((activeCapture) => (\n                <li\n                  key={activeCapture.captureId}\n                  className={classes.captureListItem}\n                >\n                  <ActiveCapture\n                    capture={activeCapture}\n                    isCurrent={\n                      currentCaptureId &&\n                      activeCapture.captureId === currentCaptureId\n                    }\n                  />\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      )}\n\n      {(loading || capturesLists.completed.length > 0) && (\n        <div>\n          {loading ? (\n            <ul className={classes.capturesList}>\n              {mockCaptureLists.completed.map((n) => (\n                <li key={n} className={classes.captureListItem}>\n                  <MockCompletedCapture n={n} />\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <ul className={classes.capturesList}>\n              {capturesLists.completed.map((completeCapture) => (\n                <li\n                  key={completeCapture.captureId}\n                  className={classes.captureListItem}\n                >\n                  <CompletedCapture\n                    capture={completeCapture}\n                    isCurrent={\n                      currentCaptureId &&\n                      completeCapture.captureId === currentCaptureId\n                    }\n                  />\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      )}\n    </nav>\n  );\n}\nfunction ActiveCapture(props) {\n  const { capture } = props;\n  const { tags } = capture;\n  const classes = useStyles();\n  const domRef = useScrollToCurrent(props.isCurrent);\n\n  const buildIdTag = tags.find(({ name }) => name === 'buildId');\n  const envTag =\n    tags.find(({ name }) => name === 'environmentName') || 'unknown';\n  const now = new Date();\n\n  return (\n    <CaptureNavLink capture={capture} isCurrent={props.isCurrent}>\n      <Card className={classNames(classes.card, classes.isActive)} ref={domRef}>\n        <h5 className={classes.buildName}>\n          Build <code className={classes.buildId}>{buildIdTag.value}</code> in{' '}\n          <code>{envTag.value}</code>\n        </h5>\n\n        <div className={classes.captureTime}>\n          <div className={classes.liveIndicator}>\n            <FiberManualRecordIcon className={classes.recordIcon} />\n            <span className={classes.liveLabel}>LIVE</span>\n          </div>\n          since {dateFormatRelative(capture.createdAt, now)}\n        </div>\n      </Card>\n    </CaptureNavLink>\n  );\n}\n\nfunction CompletedCapture(props) {\n  const { capture } = props;\n  const { tags } = capture;\n  const classes = useStyles();\n  const domRef = useScrollToCurrent(props.isCurrent);\n\n  const buildIdTag = tags.find(({ name }) => name === 'buildId');\n  const envTag = tags.find(({ name }) => name === 'environmentName');\n  const now = new Date();\n\n  return (\n    <CaptureNavLink capture={capture}>\n      <Card className={classNames(classes.card, classes.isComplete)}>\n        <div className={classes.buildName} ref={domRef}>\n          Build <code>{buildIdTag.value}</code> in <code>{envTag.value}</code>\n        </div>\n\n        <div className={classes.captureTime}>\n          <ScheduleIcon className={classes.historyIcon} />\n          ended {dateFormatRelative(capture.completedAt, now)} after{' '}\n          {dateFormatDistance(capture.completedAt, capture.createdAt)}\n        </div>\n      </Card>\n    </CaptureNavLink>\n  );\n}\n\nfunction CaptureNavLink(props) {\n  const { capture } = props;\n  const classes = useStyles();\n\n  return (\n    <ReportLink\n      className={classes.navLink}\n      captureId={capture.captureId}\n      activeClassName={classes.isCurrent}\n    >\n      {props.children}\n    </ReportLink>\n  );\n}\n\nfunction MockActiveCapture() {\n  const classes = useStyles();\n\n  return <Skeleton variant=\"rect\" className={classes.loadingCapture} />;\n}\n\nfunction MockCompletedCapture() {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.loadingCapture}>\n      <Skeleton\n        variant=\"rect\"\n        width=\"85%\"\n        height=\"1.5rem\"\n        className={classes.loadingCaptureLine}\n      />\n      <Skeleton\n        variant=\"rect\"\n        width=\"45%\"\n        height=\"1rem\"\n        className={classes.loadingCaptureLine}\n      />\n    </div>\n  );\n}\n\nfunction useScrollToCurrent(isCurrent) {\n  const linkRef = useRef();\n  useEffect(() => {\n    if (!isCurrent) return;\n\n    if (!linkRef.current)\n      throw Error(\n        'CaptureLink Ref must be set in order to scroll it into view upon activation'\n      );\n\n    scrollIntoView(linkRef.current, {\n      scrollMode: 'if-needed',\n      block: 'center',\n    });\n  }, [isCurrent]);\n\n  return linkRef;\n}\n\n// Styles\n// ------\n\nconst useStyles = makeStyles((theme) => ({\n  navRoot: {\n    padding: theme.spacing(2),\n    flexGrow: 1,\n    position: 'fixed',\n    width: 'inherit',\n    height: '100vh',\n    overflowY: 'scroll',\n\n    borderRight: `1px solid ${theme.palette.grey[300]}`,\n    background: theme.palette.grey[100],\n  },\n\n  activeCaptures: {\n    marginBottom: theme.spacing(3),\n  },\n\n  capturesList: {\n    flexGrow: 1,\n    margin: 0,\n    padding: 0,\n    listStyleType: 'none',\n  },\n\n  captureListItem: {},\n\n  navLink: {\n    textDecoration: 'none',\n  },\n\n  loadingCapture: {\n    height: '5rem',\n    marginBottom: theme.spacing(2),\n  },\n\n  loadingCaptureLine: {\n    marginBottom: theme.spacing(1.5),\n  },\n\n  card: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-start',\n    padding: theme.spacing(2),\n    marginBottom: theme.spacing(1.5),\n    boxShadow: '0 2px 4px 0 rgba(138, 148, 159, 0.3)',\n\n    willChange: 'transform,box-shadow,margin-bottom',\n    transform: 'translateX(0)',\n    transition:\n      '0.1s ease-out transform, 0.1s ease-out box-shadow, 0.1s ease-out marginBottom',\n\n    ['&$isComplete']: {\n      backgroundColor: 'transparent',\n      boxShadow: 'none',\n    },\n\n    // wrapping Link hovered\n    ['$navLink:hover &, $navLink:focus &']: {\n      boxShadow: '0 2px 4px 0 rgba(138, 148, 159, 0.6)',\n      opacity: 1,\n    },\n\n    // currently selected\n    ['$navLink$isCurrent &']: {\n      borderLeft: `3px solid ${theme.palette.updated.main}`,\n      opacity: 1,\n      transform: `translateX(${theme.spacing(1)}px)`,\n      boxShadow: [\n        '0 2px 4px 0 rgba(138, 148, 159, 0.6)',\n        '0 4px 8px 2px rgba(138, 148, 159, 0.15)',\n      ].join(','),\n      background: '#fff',\n    },\n  },\n\n  // states, just so we can use them as modifiers for other rules\n  isComplete: {},\n  isCurrent: {},\n  isActive: {},\n\n  buildName: {\n    '& code': {\n      color: theme.palette.primary.light,\n    },\n\n    '$isActive &': {\n      ...theme.typography.subtitle1,\n      fontWeight: theme.typography.fontWeightLight,\n      margin: 0,\n      marginBottom: theme.spacing(0.75),\n      // color: theme.palette.primary.main,\n      '& code': {\n        fontWeight: 'bold',\n        fontSize: theme.typography.subtitle2.fontSize,\n      },\n    },\n  },\n\n  captureTime: {\n    display: 'flex',\n    alignItems: 'center',\n    color: theme.palette.grey[500],\n    fontSize: theme.typography.pxToRem(12),\n  },\n\n  liveIndicator: {\n    display: 'flex',\n    alignItems: 'center',\n    marginRight: theme.spacing(0.5),\n  },\n\n  recordIcon: {\n    width: 16,\n    height: 16,\n    marginRight: theme.spacing(0.5),\n    fill: theme.palette.secondary.main,\n  },\n\n  liveLabel: {\n    ...theme.typography.caption,\n  },\n\n  historyIcon: {\n    width: 14,\n    height: 14,\n    marginRight: theme.spacing(0.5),\n  },\n\n  envTag: {\n    display: 'flex',\n    justifyContent: 'center',\n\n    fontSize: theme.typography.pxToRem(12),\n  },\n\n  envTagName: {\n    display: 'flex',\n    alignItems: 'center',\n    height: theme.spacing(2.5),\n    background: theme.palette.grey[100],\n    border: `1px solid ${theme.palette.grey[200]}`,\n    borderTopLeftRadius: 4,\n    borderBottomLeftRadius: 4,\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1),\n  },\n\n  envTagVal: {\n    display: 'flex',\n    alignItems: 'center',\n    height: theme.spacing(2.5),\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1),\n    borderTopRightRadius: 4,\n    borderBottomRightRadius: 4,\n    background: theme.palette.primary.light,\n    color: '#fff',\n  },\n}));\n\n// View models\n// -----------\n\nfunction createCapturesLists(rawCaptures) {\n  const captures = rawCaptures.map((rawCap) => {\n    const createdAt = dateParseISO(rawCap.createdAt);\n    const updatedAt = rawCap.updatedAt && dateParseISO(rawCap.updatedAt);\n    const completedAt = rawCap.completedAt && dateParseISO(rawCap.completedAt);\n    const isActive = !completedAt;\n\n    return {\n      ...rawCap,\n      isActive,\n      createdAt,\n      updatedAt,\n      completedAt,\n    };\n  });\n\n  const groupedByActive = groupBy(captures, (capture) =>\n    capture.isActive ? 'active' : 'completed'\n  );\n  const active = _sortBy(\n    groupedByActive['active'] || [],\n    (capture) => -capture.createdAt\n  );\n  const completed = _sortBy(\n    groupedByActive['completed'] || [],\n    (capture) => -capture.completedAt\n  );\n\n  return { active, completed };\n}\n\nfunction createMockCapturesLists() {\n  return {\n    active: Array.from({ length: 2 }, (_, n) => n),\n    completed: Array.from({ length: 5 }, (_, n) => n),\n  };\n}\n","import React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Card from '@material-ui/core/Card';\nimport CardMedia from '@material-ui/core/CardMedia';\n\nimport LiveTestingDiagram from '../../assets/marketing/optic-contract-testing-diagram.svg';\n\nexport default function TestingPromo() {\n  const classes = useStyles();\n\n  return (\n    <Card className={classes.promo}>\n      <CardMedia className={classes.promoDiagram} image={LiveTestingDiagram} />\n\n      <h2>Confidence your API is working as designed</h2>\n\n      <p>\n        Optic's Live Contract Testing validates your API is working as designed\n        in all your environments. Achieve 100% test coverage of the API's\n        contract from your live traffic.\n      </p>\n    </Card>\n  );\n}\n\nconst useStyles = makeStyles((theme) => ({\n  promo: {\n    width: '100%',\n    padding: theme.spacing(2, 3),\n\n    [theme.breakpoints.up('md')]: {\n      width: (theme.breakpoints.values.md / 4) * 3,\n    },\n\n    '& h2': {\n      ...theme.typography.h2,\n      fontSize: theme.typography.h4.fontSize,\n      color: theme.palette.primary.main,\n      margin: theme.spacing(4, 0, 2),\n    },\n\n    '& p': {\n      ...theme.typography.subtitle1,\n      fontWeight: theme.typography.fontWeightLight,\n    },\n  },\n\n  promoDiagram: {\n    height: 250,\n    margin: theme.spacing(-2, -3, 3),\n    backgroundSize: 'cover',\n    backgroundPosition: 'top center',\n  },\n}));\n","import React, { useCallback, useMemo, useState } from 'react';\nimport Loading from '../navigation/Loading';\nimport ClassNames from 'classnames';\n\n// TODO: find a more appropriate place for this logic to live rather than in\n// Contexts now that it's being re-used elsewhere.\nimport { stuffFromQueries } from '../../contexts/RfcContext';\n\n// Components and hooks\n// --------------------\nimport { Switch, Route, Redirect, matchPath } from 'react-router-dom';\nimport { makeStyles } from '@material-ui/core/styles';\nimport ReportSummary, { LoadingReportSummary } from '../testing/ReportSummary';\nimport SetupLink from '../testing/SetupLink';\nimport * as SupportLinks from '../support/Links';\n\nimport {\n  createContext,\n  Provider as TestingDashboardContextProvider,\n  queriesFromEvents,\n  useTestingService,\n} from '../../contexts/TestingDashboardContext';\nimport ReportsNavigation from '../testing/ReportsNav';\nimport Page from '../Page';\nimport { useRouterPaths } from '../../RouterPaths';\nimport TestingPromo from '../marketing/TestingPromo';\n\nconst FIRST_CAPTURE_INIT = Symbol();\n\nexport default function TestingDashboardPage(props) {\n  const { match, service } = props;\n  const hasService = !!service;\n  const baseUrl = match.url;\n  const classes = useStyles();\n  const routerPaths = useRouterPaths();\n\n  const currentCaptureId = useMemo(() => {\n    const captureMatch = matchPath(\n      props.location.pathname,\n      routerPaths.testingCapture\n    );\n\n    return captureMatch && captureMatch.params.captureId;\n  }, [props.location.pathname, routerPaths.testingCapture]);\n\n  const dashboardContext = useMemo(() => createContext({ service, baseUrl }), [\n    hasService,\n    baseUrl,\n  ]);\n\n  const [firstCapture, setFirstCapture] = useState(FIRST_CAPTURE_INIT);\n  const onCapturesFetched = useCallback((captures) => {\n    if (captures && captures.length < 1) return;\n    setFirstCapture(captures && captures[0]);\n  });\n  const hasCaptures = firstCapture === FIRST_CAPTURE_INIT || !!firstCapture; // be optimistic\n\n  if (!hasService) {\n    return <Loading />;\n  }\n\n  return (\n    <TestingDashboardContextProvider value={dashboardContext}>\n      <Page title=\"Live Contracting Dashboard\">\n        <Page.Navbar mini={true} />\n\n        <Page.Body padded={false}>\n          <div\n            className={ClassNames(classes.root, {\n              [classes.isEmpty]: !hasCaptures,\n            })}\n          >\n            <div className={classes.navigationContainer}>\n              <ReportsNavigation\n                currentCaptureId={currentCaptureId}\n                onCapturesFetched={onCapturesFetched}\n              />\n            </div>\n\n            {hasCaptures ? (\n              <div className={classes.reportContainer}>\n                <Switch>\n                  <Route\n                    strict\n                    path={routerPaths.testingEndpointDetails}\n                    component={TestingDashboard}\n                  />\n                  <Route\n                    strict\n                    path={routerPaths.testingCapture}\n                    component={TestingDashboard}\n                  />\n                  {firstCapture !== FIRST_CAPTURE_INIT && firstCapture ? (\n                    <Redirect\n                      replace\n                      to={`${baseUrl}/captures/${firstCapture.captureId}`}\n                    />\n                  ) : (\n                    <LoadingReportSummary />\n                  )}\n                </Switch>\n              </div>\n            ) : (\n              <TestingDashboardSetup assertion=\"No live captures have been found yet.\" />\n            )}\n          </div>\n        </Page.Body>\n      </Page>\n    </TestingDashboardContextProvider>\n  );\n}\n\nexport function TestingDashboardSetupPage() {\n  return (\n    <Page title=\"Live Contracting Dashboard\">\n      <Page.Navbar mini={true} />\n\n      <Page.Body padded={false}>\n        <TestingDashboardSetup />\n      </Page.Body>\n    </Page>\n  );\n}\n\nfunction TestingDashboardSetup({ assertion }) {\n  const classes = useStyles();\n\n  if (!assertion) assertion = 'Live Contract Testing has not been setup yet.';\n\n  return (\n    <div className={classes.setup}>\n      <div className={classes.setupInstructions}>\n        <h3>{assertion}</h3>\n\n        <p>\n          For help on getting started with Live Contract Testing, see{' '}\n          <SetupLink>the setup instructions</SetupLink>.\n        </p>\n\n        <p>\n          Think this might not be right? Feel free to{' '}\n          <a href={SupportLinks.Contact(`Problem: ${assertion}`)}>\n            contact us about it\n          </a>\n          .\n        </p>\n      </div>\n\n      <TestingPromo />\n    </div>\n  );\n}\n\nexport function TestingDashboard(props) {\n  const { captureId, endpointId } = props.match.params;\n  const {\n    loading: loadingReport,\n    result: report,\n    error: reportError,\n    notFound: reportNotFound,\n  } = useTestingService((service) => service.loadReport(captureId), [\n    captureId,\n  ]);\n  const { loading: loadingSpec, result: spec, error: specError } = useSpec(\n    captureId\n  );\n  const {\n    loading: loadingCapture,\n    result: capture,\n    error: captureError,\n    notFound: captureNotFound,\n  } = useTestingService((service) => service.loadCapture(captureId), [\n    captureId,\n  ]);\n\n  const {\n    loading: loadingUndocumentedEndpoints,\n    result: undocumentedEndpoints,\n    error: undocumentedEndpointsError,\n    notFound: undocumentedEndpointsNotFound,\n  } = useTestingService(\n    (service) => service.loadUndocumentedEndpoints(captureId),\n    [captureId]\n  );\n\n  const error =\n    reportError || specError || captureError || undocumentedEndpointsError;\n  if (error) throw error; // allow React error boundaries to render as we're not handling them explicitly\n\n  const notFound =\n    reportNotFound || captureNotFound || undocumentedEndpointsNotFound;\n\n  if (notFound) {\n    return <ReportNotFound />;\n  }\n\n  return (\n    <>\n      {(loadingReport ||\n        loadingSpec ||\n        loadingCapture ||\n        loadingUndocumentedEndpoints) && <LoadingReportSummary />}\n\n      {report && spec && capture && undocumentedEndpoints && (\n        <ReportSummary\n          report={report}\n          spec={spec}\n          capture={capture}\n          currentEndpointId={endpointId}\n          undocumentedEndpoints={undocumentedEndpoints}\n        />\n      )}\n    </>\n  );\n}\n\nfunction ReportNotFound(props) {\n  const classes = useStyles();\n  return (\n    <div className={classes.notFound}>\n      <h4>The Report you're trying to access could not be found.</h4>\n\n      <p>\n        Looking for the right report? All available reports are listed in the\n        navigation on the left.\n      </p>\n\n      <p>\n        Think this might not be right? Feel free to{' '}\n        <a href={SupportLinks.Contact('Problem: Report not found')}>\n          contact us about it\n        </a>\n        .\n      </p>\n    </div>\n  );\n}\n\nfunction useSpec(captureId) {\n  const { result: specEvents, ...hookRest } = useTestingService(\n    (service) => service.loadSpecEvents(captureId),\n    [captureId]\n  );\n\n  const spec = useMemo(() => {\n    if (!specEvents) return null;\n\n    return createSpec(specEvents);\n  }, [specEvents]);\n\n  // calling this spec instead of rfcState, to differentiate this as a ViewModel,\n  // rather than RfcState.\n  return { ...hookRest, result: spec };\n}\n\n// Styles\n// ------\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    flexGrow: 1,\n    [theme.breakpoints.down('sm')]: {\n      flexDirection: 'column', // stack vertically on smaller screens for now\n    },\n    [theme.breakpoints.up('sm')]: {\n      flexDirection: 'row', // horizontally on larger screens\n    },\n  },\n\n  isEmpty: {},\n\n  navigationContainer: {\n    // keep then navigation fixed\n    width: '100%',\n    flexGrow: 0,\n    flexShrink: 0,\n    display: 'flex',\n\n    [theme.breakpoints.up('sm')]: {\n      width: (theme.breakpoints.values.sm / 3) * 2,\n    },\n\n    '$isEmpty &': {\n      display: 'none',\n    },\n  },\n  reportContainer: {\n    display: 'flex',\n    flexGrow: 1,\n    flexShrink: 1,\n    justifyContent: 'center',\n  },\n\n  setup: {\n    flexGrow: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n\n    [theme.breakpoints.down('md')]: {\n      padding: theme.spacing(0, 3),\n    },\n  },\n\n  setupInstructions: {\n    width: '100%',\n    marginBottom: theme.spacing(3),\n\n    [theme.breakpoints.up('md')]: {\n      padding: theme.spacing(2, 3),\n      width: (theme.breakpoints.values.md / 4) * 3,\n    },\n\n    '& h3': {\n      ...theme.typography.h4,\n      color: theme.palette.primary.main,\n    },\n\n    '& p': {\n      ...theme.typography.body1,\n      // fontSize:\n      fontWeight: theme.typography.fontWeightLight,\n    },\n  },\n\n  notFound: {\n    padding: theme.spacing(3, 4),\n\n    '& h4': {\n      ...theme.typography.h4,\n      color: theme.palette.primary.main,\n    },\n\n    '& p': {\n      ...theme.typography.body1,\n      // fontSize:\n      fontWeight: theme.typography.fontWeightLight,\n    },\n  },\n}));\n\n// View models\n// -----------\n// TODO: consider moving these into their own modules or another appropriate spot (probably stable\n// for the entire dashboard context if not all of the app?)\n\nfunction createSpec(specEvents) {\n  const { queries } = queriesFromEvents(specEvents);\n  const spec = stuffFromQueries(queries);\n\n  return spec;\n}\n","import {\n  ITestingService,\n  Capture,\n  CoverageReport,\n  Result,\n  ok,\n  err,\n  NotFoundError,\n  RfcEventStream,\n  UndocumentedEndpoint,\n} from '.';\nimport UrlJoin from 'url-join';\nimport { StableHasher } from '../../utilities/CoverageUtilities';\nimport { opticEngine } from '@useoptic/domain';\n\n// TODO: implement ITestingService\nexport class TestingService implements ITestingService {\n  private authToken: string;\n  private refreshing?: Promise<unknown>;\n\n  constructor(\n    private fetchAuthToken: () => PromiseLike<Response>,\n    private baseUrl: string\n  ) {\n    this.refreshAuth();\n  }\n\n  private async callApi(\n    path: string,\n    options: RequestInit = {}\n  ): Promise<Response> {\n    const headers = new Headers(options.headers || {});\n    const { authToken } = this;\n\n    const url = UrlJoin(this.baseUrl, path);\n\n    if (!authToken) {\n      await this.refreshAuth();\n    }\n\n    headers.set('Authorization', `Bearer ${this.authToken}`);\n\n    const response = await fetch(url, {\n      ...options,\n      headers,\n    });\n\n    if (!response.ok && response.status === 401) {\n      this.refreshAuth(); // trigger refreshing of auth after an Unauthorized, but don't wait on it or retry for now\n    }\n\n    return response;\n  }\n\n  private async refreshAuth() {\n    if (!this.refreshing) {\n      const refresh = async () => {\n        const response = await this.fetchAuthToken();\n\n        if (!response.ok)\n          throw new Error(\n            'Could not fetch testing credentials required to use TestingService'\n          );\n\n        const payload = await response.json();\n        if (!payload.authToken)\n          throw new Error(\n            'Could not fetch usable testing credentials to use Testing Service'\n          );\n\n        this.authToken = payload.authToken;\n        this.refreshing = null;\n      };\n      // only refresh auth once, no matter how many endpoints are waiting\n      this.refreshing = refresh();\n    }\n\n    return this.refreshing;\n  }\n\n  async listCaptures(): Promise<Result<Capture[]>> {\n    const response = await this.callApi('/captures');\n\n    if (!response.ok) throw new Error('List of captures could not be fetched');\n\n    const payload = await response.json();\n\n    return ok(payload.captures);\n  }\n\n  async loadCapture(captureId): Promise<Result<Capture, NotFoundError>> {\n    const response = await this.callApi(`/captures/${captureId}`);\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        return err(new NotFoundError());\n      } else {\n        throw new Error('Capture could not be fetched');\n      }\n    }\n\n    const payload = await response.json();\n\n    return ok(payload);\n  }\n\n  async loadReport(captureId): Promise<Result<CoverageReport, NotFoundError>> {\n    const response = await this.callApi(\n      `/captures/${captureId}/reports/coverage`\n    );\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        return err(new NotFoundError());\n      } else {\n        throw new Error('CoverageReport for capture could not be fetched');\n      }\n    }\n\n    const payload = await response.json();\n    const deserialized = opticEngine.CoverageReportJsonDeserializer.fromJs(\n      payload\n    );\n    const converter = new opticEngine.com.useoptic.CoverageReportConverter(\n      StableHasher\n    );\n    const serializedReport = converter.toJs(deserialized);\n    return ok(serializedReport);\n  }\n\n  async loadUndocumentedEndpoints(\n    captureId\n  ): Promise<Result<UndocumentedEndpoint[], NotFoundError>> {\n    const response = await this.callApi(\n      `/captures/${captureId}/reports/undocumented-urls`\n    );\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        return err(new NotFoundError());\n      } else {\n        throw new Error(\n          'Undocumented endpoints for capture could not be fetched'\n        );\n      }\n    }\n\n    const payload = await response.json();\n    return ok(payload);\n  }\n\n  async loadSpecEvents(\n    captureId\n  ): Promise<Result<RfcEventStream, NotFoundError>> {\n    const response = await this.callApi(`/captures/${captureId}/spec`);\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        return err(new NotFoundError());\n      } else {\n        throw new Error('Spec for capture could not be fetched');\n      }\n    }\n\n    const payload = await response.json();\n\n    return ok(payload);\n  }\n}\n","export default {\n  testingService: {\n    baseUrl: '/api/testing',\n  },\n};\n","import React, { useEffect, useState } from 'react';\nimport TestingDashboard, {\n  TestingDashboardSetupPage,\n} from '../dashboards/TestingDashboard';\nimport { useMockData } from '../../contexts/MockDataContext';\nimport {\n  useSpecService,\n  useEnabledFeatures,\n} from '../../contexts/SpecServiceContext';\n\nimport { createExampleTestingService } from '../../services/testing/ExampleTestingService';\nimport { TestingService } from '../../services/testing/TestingService';\nimport Config from '../../config';\n\nexport default function TestingServiceLoader(props) {\n  const debugData = useMockData();\n\n  const [service, setService] = useState(null);\n  const specService = useSpecService();\n  const enabledFeatures = useEnabledFeatures();\n\n  useEffect(() => {\n    if (\n      (debugData.available && debugData.loading) || // wait until next time when example data has been fetched\n      !enabledFeatures ||\n      !enabledFeatures.TESTING_DASHBOARD // don't setup if we're not sure testing is enabled\n    )\n      return;\n\n    const serviceFactory = debugData.available\n      ? () => createExampleTestingServiceFactory(debugData.data)\n      : async () =>\n          new TestingService(\n            specService.getTestingCredentials.bind(specService),\n            Config.testingService.baseUrl\n          );\n\n    const task = async () => {\n      const s = await serviceFactory();\n      setService(s);\n    };\n    task();\n  }, [debugData.available, debugData.loading, specService]);\n\n  if (enabledFeatures && !enabledFeatures.TESTING_DASHBOARD) {\n    return <TestingDashboardSetupPage />;\n  }\n\n  return <TestingDashboard service={service} {...props} />;\n}\n\nasync function createExampleTestingServiceFactory(data) {\n  const reportsExample =\n    data.refs && data.refs.find(({ rel }) => rel === 'example-reports');\n\n  return createExampleTestingService(reportsExample && reportsExample.id);\n}\n"],"sourceRoot":""}